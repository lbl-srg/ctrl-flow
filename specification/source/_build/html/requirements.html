

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>4. Requirements &#8212; LinkageJS Requirements Specification</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css" />
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap_custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom-sphinx.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/lbl-icon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="8. Software Architecture" href="softwareArchitecture.html" />
    <link rel="prev" title="3. Process Workflow" href="process.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default ">
    <div class="container-fluid">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          LinkageJS</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="index.html">Table of Contents</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preamble.html">1. Preamble</a><ul>
<li class="toctree-l2"><a class="reference internal" href="preamble.html#purpose-of-the-document">1.1. Purpose of the Document</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="conventions.html">2. Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="process.html">3. Process Workflow</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. Requirements</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-description">4.1. General description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modelica-graphical-user-interface">4.2. Modelica Graphical User Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="#schematics-export">4.3. Schematics Export</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration-widget">4.4. Configuration Widget</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#loading-a-modelica-model-with-linkagejs-annotations">5. Loading a Modelica Model with LinkageJS Annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="#questions">6. Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="#to-do">7. To Do</a></li>
<li class="toctree-l1"><a class="reference internal" href="softwareArchitecture.html">8. Software Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="annex.html">9. Annex</a><ul>
<li class="toctree-l2"><a class="reference internal" href="annex.html#validation-of-bus-connections">9.1. Validation of Bus Connections</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">10. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgments.html">11. Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">12. References</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">4. Requirements</a><ul>
<li><a class="reference internal" href="#general-description">4.1. General description</a><ul>
<li><a class="reference internal" href="#software-compatibility">4.1.1. Software Compatibility</a></li>
<li><a class="reference internal" href="#structure">4.1.2. Structure</a></li>
<li><a class="reference internal" href="#functionalities">4.1.3. Functionalities</a></li>
</ul>
</li>
<li><a class="reference internal" href="#modelica-graphical-user-interface">4.2. Modelica Graphical User Interface</a><ul>
<li><a class="reference internal" href="#generating-connections">4.2.1. Generating Connections</a></li>
</ul>
</li>
<li><a class="reference internal" href="#schematics-export">4.3. Schematics Export</a></li>
<li><a class="reference internal" href="#configuration-widget">4.4. Configuration Widget</a><ul>
<li><a class="reference internal" href="#id5">4.4.1. Functionalities</a></li>
<li><a class="reference internal" href="#fluid-connectors">4.4.2. Fluid Connectors</a></li>
<li><a class="reference internal" href="#signal-connectors">4.4.3. Signal Connectors</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#loading-a-modelica-model-with-linkagejs-annotations">5. Loading a Modelica Model with LinkageJS Annotations</a></li>
<li><a class="reference internal" href="#questions">6. Questions</a></li>
<li><a class="reference internal" href="#to-do">7. To Do</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="process.html" title="Previous Chapter: 3. Process Workflow"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 3. Process Workflow</span>
    </a>
  </li>
  <li>
    <a href="softwareArchitecture.html" title="Next Chapter: 8. Software Architecture"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">8. Software A... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

<!--
          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
-->
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">4. Requirements</a><ul>
<li><a class="reference internal" href="#general-description">4.1. General description</a><ul>
<li><a class="reference internal" href="#software-compatibility">4.1.1. Software Compatibility</a></li>
<li><a class="reference internal" href="#structure">4.1.2. Structure</a></li>
<li><a class="reference internal" href="#functionalities">4.1.3. Functionalities</a></li>
</ul>
</li>
<li><a class="reference internal" href="#modelica-graphical-user-interface">4.2. Modelica Graphical User Interface</a><ul>
<li><a class="reference internal" href="#generating-connections">4.2.1. Generating Connections</a></li>
</ul>
</li>
<li><a class="reference internal" href="#schematics-export">4.3. Schematics Export</a></li>
<li><a class="reference internal" href="#configuration-widget">4.4. Configuration Widget</a><ul>
<li><a class="reference internal" href="#id5">4.4.1. Functionalities</a></li>
<li><a class="reference internal" href="#fluid-connectors">4.4.2. Fluid Connectors</a></li>
<li><a class="reference internal" href="#signal-connectors">4.4.3. Signal Connectors</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#loading-a-modelica-model-with-linkagejs-annotations">5. Loading a Modelica Model with LinkageJS Annotations</a></li>
<li><a class="reference internal" href="#questions">6. Questions</a></li>
<li><a class="reference internal" href="#to-do">7. To Do</a></li>
</ul>

  <li>
    <a href="process.html" title="Previous Chapter: 3. Process Workflow"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 3. Process Workflow</span>
    </a>
  </li>
  <li>
    <a href="softwareArchitecture.html" title="Next Chapter: 8. Software Architecture"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">8. Software A... &raquo;</span>
    </a>
  </li>
<form action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="requirements">
<span id="sec-requirements"></span><h1>4. Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h1>
<p>This section describes the functional, mathematical and software requirements.</p>
<div class="section" id="general-description">
<h2>4.1. General description<a class="headerlink" href="#general-description" title="Permalink to this headline">¶</a></h2>
<p>The software is a graphical user interface for editing Modelica models.
In this respect it must comply with the Modelica language specification <a class="reference internal" href="bibliography.html#modelica2017" id="id1">[Mod17]</a> for every aspect relating to (the chapter numbers refer to <a class="reference internal" href="bibliography.html#modelica2017" id="id2">[Mod17]</a>):</p>
<ul class="simple">
<li><p>validating the syntax of the user inputs: see <em>Chapter 2 Lexical Structure</em> and <em>Chapter 3 Operators and Expressions</em>,</p></li>
<li><p>the connection between objects: see <em>Chapter 9 Connectors and Connections</em>,</p></li>
<li><p>the structure of packages: see <em>Chapter 13 Packages</em>,</p></li>
<li><p><cite>to be updated</cite>.</p></li>
</ul>
<div class="section" id="software-compatibility">
<h3>4.1.1. Software Compatibility<a class="headerlink" href="#software-compatibility" title="Permalink to this headline">¶</a></h3>
<span id="tab-environment"></span><table class="docutils align-default" id="id7">
<caption><span class="caption-number">Table 4.1 </span><span class="caption-text">Requirements for software compatibility</span><a class="headerlink" href="#id7" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 33%" />
<col style="width: 67%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Feature</p></th>
<th class="head"><p>Support</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Platform (minimum version)</p></td>
<td><p>Windows (10), Linux Ubuntu (16.04), OS X (10.10)</p></td>
</tr>
<tr class="row-odd"><td><p>Web browser</p></td>
<td><p>Chrome, Firefox, Safari</p></td>
</tr>
<tr class="row-even"><td><p>Offline version</p></td>
<td><p>Running on local server with access to resources hosted on the file system</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="structure">
<h3>4.1.2. Structure<a class="headerlink" href="#structure" title="Permalink to this headline">¶</a></h3>
<p>See figure <a class="reference internal" href="#screen-conf-1"><span class="std std-numref">Fig. 4.4</span></a>:</p>
<ul>
<li><p>Left panel: library navigator</p></li>
<li><p>Main panel: diagram view of the model</p></li>
<li><p>Right panel:</p>
<blockquote>
<div><ul class="simple">
<li><p>Configuration widget</p></li>
<li><p>Connection widget</p></li>
<li><p>Annotation widget</p></li>
<li><p>Parameters widget</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Menu bar</p></li>
<li><p>Bottom panel: console</p></li>
</ul>
</div>
<div class="section" id="functionalities">
<h3>4.1.3. Functionalities<a class="headerlink" href="#functionalities" title="Permalink to this headline">¶</a></h3>
<span id="tab-gui-func"></span><table class="colwidths-given docutils align-default" id="id8">
<caption><span class="caption-number">Table 4.2 </span><span class="caption-text">Functionalities of the user interface – R: required, P: required partially, O: optional, N: not required</span><a class="headerlink" href="#id8" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 22%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 56%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Feature</p></th>
<th class="head"><p>V0</p></th>
<th class="head"><p>V1</p></th>
<th class="head"><p>Comment</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>I/O</strong></p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Load <code class="docutils literal notranslate"><span class="pre">mo</span></code> file</p></td>
<td><p>R</p></td>
<td></td>
<td><div class="line-block">
<div class="line">Simple Modelica model or full package.</div>
<div class="line">If the model contains annotations specific to the configurations script, the corresponding data model is loaded in memory for further configuration.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>Export simulation results</p></td>
<td><p>R</p></td>
<td></td>
<td><p>Export in the following format: <code class="docutils literal notranslate"><span class="pre">mat,</span> <span class="pre">csv</span></code>. All variables or selection based on variables browser (see below).</p></td>
</tr>
<tr class="row-odd"><td><p>Variables browser</p></td>
<td><p>P</p></td>
<td><p>R</p></td>
<td><p>Query selection of model variables based on regular expression (V0) or Brick/Haystack tag <a class="reference internal" href="bibliography.html#brick" id="id3">[Bri]</a> <a class="reference internal" href="bibliography.html#haystack4" id="id4">[Hay]</a> (V1)</p></td>
</tr>
<tr class="row-even"><td><p>Plot simulation results</p></td>
<td><p>N</p></td>
<td><p>O</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Text editor</p></td>
<td><p>N</p></td>
<td><p>O</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Export control points summary</p></td>
<td><p>R</p></td>
<td><p>R</p></td>
<td><p>Relies on LBNL module to generate the list of A/D I/O variables.</p></td>
</tr>
<tr class="row-odd"><td><p>Export schematics</p></td>
<td><p>P</p></td>
<td><p>R</p></td>
<td><div class="line-block">
<div class="line">Only the equipment drawing in V0. Control points and SOO description in V1 see <a class="reference internal" href="#screen-schematics-modelica"><span class="std std-numref">Fig. 4.1</span></a>.</div>
<div class="line">Relies on LBNL module CDL to Word translator.</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>Import/Export data sheet</p></td>
<td><p>P</p></td>
<td><p>R</p></td>
<td><p>Additional module to 1) generate a file in CSV (or Excel) format from the configuration data model (V0)
2) populate the configuration data model based on a file input in CSV (or Excel) format (V1).</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Modelica features</strong></p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Checking the compliance with Modelica standard</p></td>
<td><p>P</p></td>
<td><p>R</p></td>
<td><p>Real-time checking of syntax (V0) and connection (V1).</p></td>
</tr>
<tr class="row-odd"><td><p>Translate model</p></td>
<td><p>P</p></td>
<td></td>
<td><p>The software settings allow the user to specify a command for translating the model with a third party Modelica tool e.g. JModelica.</p></td>
</tr>
<tr class="row-even"><td><p>Simulate model</p></td>
<td><p>P</p></td>
<td></td>
<td><p>The software settings allow the user to specify a command for simulating the model with a third party Modelica tool e.g. JModelica.</p></td>
</tr>
<tr class="row-odd"><td><p>Automatic medium propagation between connected components</p></td>
<td><p>P</p></td>
<td><p>P</p></td>
<td><div class="line-block">
<div class="line">Partially supported because the configuration widget integrates that feature.</div>
<div class="line">When generating <code class="docutils literal notranslate"><span class="pre">connect</span></code> equation manually a similar approach as the <em>fluid path</em> used by the configuration widget should be developed, see components with 4 ports and 2 medium.</div>
<div class="line">Expected as a future enhancement of Modelica standard: should we anticipate or wait and see?</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p><strong>Object manipulation</strong></p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Vectorized instances</p></td>
<td><p>R</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Expandable connectors</p></td>
<td><p>R</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Navigation in object composition</p></td>
<td><p>R</p></td>
<td></td>
<td><p>Right clicking an icon in the diagram view offers the option to open the model in another tab</p></td>
</tr>
<tr class="row-even"><td><p><strong>Graphical features</strong></p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Support of Modelica graphical annotations</p></td>
<td><p>R</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Icon layer</p></td>
<td><p>O</p></td>
<td><p>O</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Draw shape, text box</p></td>
<td><p>O</p></td>
<td><p>R</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>Customize connection lines</p></td>
<td><p>O</p></td>
<td><p>R</p></td>
<td><p>Color, width and line can be specified in the <cite>Annotation Panel</cite></p></td>
</tr>
<tr class="row-odd"><td><p>Hover information</p></td>
<td><p>R</p></td>
<td></td>
<td><p>Class path when hovering an object in the diagram view and tooltip for each GUI element</p></td>
</tr>
<tr class="row-even"><td><p>Color and style of connection lines</p></td>
<td><p>P</p></td>
<td><p>R</p></td>
<td><div class="line-block">
<div class="line">Allow the user to manually specify (right click menu) the style of the connections lines (V0).</div>
<div class="line">When generating a <code class="docutils literal notranslate"><span class="pre">connect</span></code> equation automatically select a line style based on some heuristic to be further specified (V1).</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>Fancy connection lines</p></td>
<td><p>N</p></td>
<td><p>O</p></td>
<td><div class="line-block">
<div class="line">Gridified layout <a class="reference external" href="https://ialab.it.monash.edu/webcola/examples/dotpowergraph.html">https://ialab.it.monash.edu/webcola/examples/dotpowergraph.html</a></div>
<div class="line">Orthogonal edge route layout <a class="reference external" href="https://www.visual-paradigm.com/support/documents/vpuserguide/1283/28/6047_automaticdia.html">https://www.visual-paradigm.com/support/documents/vpuserguide/1283/28/6047_automaticdia.html</a></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p><strong>Miscellaneous</strong></p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Choice of units SI / IP</p></td>
<td><p>?</p></td>
<td><p>?</p></td>
<td></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="modelica-graphical-user-interface">
<h2>4.2. Modelica Graphical User Interface<a class="headerlink" href="#modelica-graphical-user-interface" title="Permalink to this headline">¶</a></h2>
<div class="section" id="generating-connections">
<h3>4.2.1. Generating Connections<a class="headerlink" href="#generating-connections" title="Permalink to this headline">¶</a></h3>
<p>When drawing a connection line between two connector icons:</p>
<ul>
<li><p>a <code class="docutils literal notranslate"><span class="pre">connect</span></code> equation with the references to the two connectors is created,</p></li>
<li><p>with a graphical annotation defining the connection path as an array of points and providing an optional smoothing function e.g. Bezier.</p>
<blockquote>
<div><ul>
<li><p>When no smoothing function is specified the connection path must be rendered graphically as a set of segments.</p></li>
<li><p>The array of points is either:</p>
<blockquote>
<div><ul class="simple">
<li><p>created fully automatically when the next user’s click after having started a connection is made on a connector icon. The function call <code class="docutils literal notranslate"><span class="pre">create_new_path(connector1,</span> <span class="pre">connector2)</span></code> creates the minimum number of <em>vertical or horizontal</em> segments to link the two connector icons with the constraint of avoiding overlaying any instantiated object,</p></li>
<li><p>created semi automatically based on the input points corresponding to the user clicks outside any connector icon: the function call <code class="docutils literal notranslate"><span class="pre">create_new_path(point[i],</span> <span class="pre">point[i+1])</span></code> is called to generate the path linking each pair of points together.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="schematics-export">
<h2>4.3. Schematics Export<a class="headerlink" href="#schematics-export" title="Permalink to this headline">¶</a></h2>
<div class="figure align-default" id="screen-schematics-modelica">
<img alt="_images/screen_schematics_modelica.svg" src="_images/screen_schematics_modelica.svg" /><p class="caption"><span class="caption-number">Fig. 4.1 </span><span class="caption-text">Mockup of the schematics export – Input Modelica file</span><a class="headerlink" href="#screen-schematics-modelica" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="screen-schematics-output">
<img alt="_images/screen_schematics_output.svg" src="_images/screen_schematics_output.svg" /><p class="caption"><span class="caption-number">Fig. 4.2 </span><span class="caption-text">Mockup of the schematics export – Output file (format to be specified: Word or PDF)</span><a class="headerlink" href="#screen-schematics-output" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="configuration-widget">
<h2>4.4. Configuration Widget<a class="headerlink" href="#configuration-widget" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id5">
<h3>4.4.1. Functionalities<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>The configuration widget allows the user to generate a Modelica model of an HVAC system and its controls by filling up a simple input form.
There are two fundamental requirements regarding the generated model:</p>
<ol class="arabic simple">
<li><p>It must be “graphically readable” (both within LinkageJS and within any third-party Modelica GUI e.g. Dymola): this is a strong constraint regarding the connections that must be generated automatically.</p></li>
<li><p>It must be ready to simulate: no additional modeling work or parameters setting is needed outside the configuration widget.</p></li>
</ol>
<p>The input form is provided by the developer (LBNL) in a data model with a format that is to be specified.</p>
<p>The data model typically provides for each entry:</p>
<ul class="simple">
<li><p>the HTML widget and populating data to be used for requesting user input,</p></li>
<li><p>the modeling data required to instantiate, position and set up the parameters of the different components,</p></li>
<li><p>some tags to be used to automatically generate the connections between the different components connectors.</p></li>
</ul>
<p>The user interface logic is illustrated in figures <a class="reference internal" href="#screen-conf-0"><span class="std std-numref">Fig. 4.3</span></a> and <a class="reference internal" href="#screen-conf-1"><span class="std std-numref">Fig. 4.4</span></a>.</p>
<div class="figure align-default" id="screen-conf-0">
<img alt="_images/screen_conf_0.svg" src="_images/screen_conf_0.svg" /><p class="caption"><span class="caption-number">Fig. 4.3 </span><span class="caption-text">Configuration widget – Configuring a new model</span><a class="headerlink" href="#screen-conf-0" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="screen-conf-1">
<img alt="_images/screen_conf_1.svg" src="_images/screen_conf_1.svg" /><p class="caption"><span class="caption-number">Fig. 4.4 </span><span class="caption-text">Configuration widget – Configuring an existing model</span><a class="headerlink" href="#screen-conf-1" title="Permalink to this image">¶</a></p>
</div>
<p>The envisioned data model supporting this logic is illustrated in <a class="reference internal" href="#code-conf-ahu"><span class="std std-numref">Listing 4.1</span></a> where:</p>
<ul>
<li><p>the components referenced under the <code class="docutils literal notranslate"><span class="pre">equipment</span></code> name are connected together in one dedicated equipment model,</p></li>
<li><p>the components referenced under the <code class="docutils literal notranslate"><span class="pre">controls</span></code> name are connected together in one dedicated controls model,</p></li>
<li><p>the components referenced under the <code class="docutils literal notranslate"><span class="pre">dependencies</span></code> name are part of the equipment model:</p>
<blockquote>
<div><ul class="simple">
<li><p>they typically correspond to sensors and outside fluid connectors,</p></li>
<li><p>the model completeness depends on their presence,</p></li>
<li><p>the requirements for their presence can be deduced from the equipment and controls options,</p></li>
<li><p>they do not need additional fields in the user form of the configuration widget.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>the equipment and controls models are connected together by means of a <cite>control bus</cite>, see <a class="reference internal" href="#screen-schematics-modelica"><span class="std std-numref">Fig. 4.1</span></a>: the upper-level model including the equipment and controls models is the ultimate output of the configuration widget (see <a class="reference internal" href="#screen-conf-1"><span class="std std-numref">Fig. 4.4</span></a> where the component named <code class="docutils literal notranslate"><span class="pre">AHU_1_01_02</span></code> represents an instance of the upper-level model <code class="docutils literal notranslate"><span class="pre">AHU_1</span></code> generated by the widget). That component exposes the outside fluid connectors as well as the top level control bus.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The pseudo code in <a class="reference internal" href="#code-conf-ahu"><span class="std std-numref">Listing 4.1</span></a> uses functions such as <code class="docutils literal notranslate"><span class="pre">find_equipment</span></code> or <code class="docutils literal notranslate"><span class="pre">find_parameter</span></code> to simplify the syntax when auto referencing the data structure.</p>
<p>To solve:</p>
<blockquote>
<div><ul>
<li><p>Test headered VS dedicated chilled water pump: conditional number of instances, placement and fluid path. Idea: the first dedicated pump can be instantiated in the equipment section, the others in the dependencies section.</p></li>
<li><p>Conditional dependencies: model and placement require <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">then</span></code> statements e.g. AFMS depending on economizer dampers option.</p></li>
<li><p>Best format: JSON (expensive especially for boolean conditions), Python class, MapperClass from NREL URBANopt GeoJSON…</p></li>
<li><p>Controls specification based on a standard</p>
<blockquote>
<div><ul>
<li><p>Top level controller with a list of parameters to be exposed as control options e.g.:</p>
<blockquote>
<div><ul class="simple">
<li><p>when they condition the model structure e.g. <code class="docutils literal notranslate"><span class="pre">use_enthalpy</span></code> requires an additional enthalpy sensor,</p></li>
<li><p>when they condition the dimension or instanciation of some connectors e.g. <code class="docutils literal notranslate"><span class="pre">numZon</span></code>, <code class="docutils literal notranslate"><span class="pre">have_occSen</span></code>.</p></li>
<li><p>when no default value is provided e.g. <code class="docutils literal notranslate"><span class="pre">AFlo</span></code> cf. requirement that the model generated by the configuration widget must be ready to simulate.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>The other parameters are accessible outside of the configuration widget through the parameters panel.</p></li>
<li><p><cite>to be updated</cite>: having high level parameters exposed in the configuration widget and low level parameters exposed in the parameters panel is confusing.</p></li>
<li><p>The alternative is to have a list of controller options for each equipment, the options are made available based on the standard selected (if any).</p>
<blockquote>
<div><ul class="simple">
<li><p>To be tested: can the “fluid path” mechanism also support</p></li>
<li><p>The connections between the different control blocks rely on the control bus.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</div>
<div class="literal-block-wrapper docutils container" id="code-conf-ahu">
<div class="code-block-caption"><span class="caption-number">Listing 4.1 </span><span class="caption-text">Partial example of the configuration data model for an air handling unit</span><a class="headerlink" href="#code-conf-ahu" title="Permalink to this code">¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
      <span class="nt">&quot;system&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;System type&quot;</span><span class="p">,</span>
            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;AHU&quot;</span>
      <span class="p">},</span>

      <span class="nt">&quot;icon&quot;</span><span class="p">:</span> <span class="s2">&quot;path of icon.mo&quot;</span><span class="p">,</span>

      <span class="nt">&quot;diagram&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;configuration&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
            <span class="nt">&quot;modelica&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">-120</span><span class="p">,</span><span class="mi">-200</span><span class="p">],</span> <span class="p">[</span><span class="mi">120</span><span class="p">,</span><span class="mi">120</span><span class="p">]]</span>
      <span class="p">},</span>

      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Model name&quot;</span><span class="p">,</span>
            <span class="nt">&quot;widget&quot;</span><span class="p">:</span> <span class="s2">&quot;Text&quot;</span><span class="p">,</span>
            <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;AHU_#i&quot;</span>
      <span class="p">},</span>

      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Type of AHU&quot;</span><span class="p">,</span>
            <span class="nt">&quot;widget&quot;</span><span class="p">:</span> <span class="s2">&quot;Dropdown&quot;</span><span class="p">,</span>
            <span class="nt">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;VAV&quot;</span><span class="p">,</span> <span class="s2">&quot;DOA&quot;</span><span class="p">,</span> <span class="s2">&quot;Supply Only&quot;</span><span class="p">,</span> <span class="s2">&quot;Exhaust Only&quot;</span><span class="p">]</span>
      <span class="p">},</span>

      <span class="nt">&quot;fluid_path&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;air_supply&quot;</span><span class="p">:</span> <span class="p">[</span>
                  <span class="p">{</span><span class="nt">&quot;start_port&quot;</span><span class="p">:</span> <span class="s2">&quot;port_outAir&quot;</span><span class="p">},</span>
                  <span class="p">{</span><span class="nt">&quot;end_port&quot;</span><span class="p">:</span> <span class="s2">&quot;port_supAir&quot;</span><span class="p">},</span>
                  <span class="p">{</span><span class="nt">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">},</span>
                  <span class="p">{</span><span class="nt">&quot;medium&quot;</span><span class="p">:</span> <span class="s2">&quot;Buildings.Media.Air&quot;</span><span class="p">}</span>
            <span class="p">]</span>
      <span class="p">},</span>

      <span class="nt">&quot;equipment&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;heaRec&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Heat recovery&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;widget&quot;</span><span class="p">:</span> <span class="s2">&quot;Dropdown&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;condition&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="nt">&quot;#type&quot;</span><span class="p">:</span> <span class="s2">&quot;DOA&quot;</span><span class="p">}</span>
                  <span class="p">],</span>
                  <span class="nt">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="s2">&quot;Fixed plate&quot;</span><span class="p">,</span> <span class="s2">&quot;Enthalpy wheel&quot;</span><span class="p">,</span> <span class="s2">&quot;Sensible wheel&quot;</span><span class="p">],</span>
                  <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;None&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;model&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="kc">null</span><span class="p">,</span>
                        <span class="s2">&quot;Buildings.Fluid.HeatExchangers.PlateHeatExchangerEffectivenessNTU&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Buildings.Fluid.HeatExchangers.EnthalpyWheel&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Buildings.Fluid.HeatExchangers.EnthalpyWheel(sensible=true)&quot;</span>
                  <span class="p">],</span>
                  <span class="nt">&quot;icon_transformation&quot;</span><span class="p">:</span> <span class="s2">&quot;flipHorizontal&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;placement&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
                  <span class="nt">&quot;connect_tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;connectors&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;port_a1&quot;</span><span class="p">:</span> <span class="s2">&quot;air_return_inlet&quot;</span><span class="p">,</span> <span class="nt">&quot;port_a2&quot;</span><span class="p">:</span> <span class="s2">&quot;air_supply_inlet&quot;</span><span class="p">,</span> <span class="nt">&quot;port_b1&quot;</span><span class="p">:</span> <span class="s2">&quot;air_return_outlet&quot;</span><span class="p">,</span> <span class="nt">&quot;port_b2&quot;</span><span class="p">:</span> <span class="s2">&quot;air_supply_outlet&quot;</span>
                  <span class="p">}}</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;eco&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Economizer&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;widget&quot;</span><span class="p">:</span> <span class="s2">&quot;Dropdown&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="s2">&quot;Separate dedicated OA dampers&quot;</span><span class="p">,</span> <span class="s2">&quot;Single common OA damper&quot;</span><span class="p">],</span>
                  <span class="nt">&quot;condition&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="nt">&quot;#type&quot;</span><span class="p">:</span> <span class="s2">&quot;VAV&quot;</span><span class="p">}</span>
                  <span class="p">],</span>
                  <span class="nt">&quot;model&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="kc">null</span><span class="p">,</span>
                        <span class="s2">&quot;Buildings.Fluid.Actuators.Dampers.MixingBoxMinimumFlow&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Buildings.Fluid.Actuators.Dampers.MixingBox&quot;</span>
                  <span class="p">],</span>
                  <span class="nt">&quot;icon_transformation&quot;</span><span class="p">:</span> <span class="s2">&quot;flipVertical&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;placement&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
                  <span class="nt">&quot;connect_tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;connectors&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="nt">&quot;port_Out&quot;</span><span class="p">:</span> <span class="s2">&quot;air_supply_junction&quot;</span><span class="p">,</span> <span class="nt">&quot;port_OutMin&quot;</span><span class="p">:</span> <span class="s2">&quot;air_supply_junction&quot;</span><span class="p">,</span> <span class="nt">&quot;port_Sup&quot;</span><span class="p">:</span> <span class="s2">&quot;air_supply_outlet&quot;</span><span class="p">,</span>
                        <span class="nt">&quot;port_Exh&quot;</span><span class="p">:</span> <span class="s2">&quot;air_return_outlet&quot;</span><span class="p">,</span> <span class="nt">&quot;port_Ret&quot;</span><span class="p">:</span> <span class="s2">&quot;air_return_inlet&quot;</span>
                  <span class="p">}}</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;supFan&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Supply fan&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;widget&quot;</span><span class="p">:</span> <span class="s2">&quot;Dropdown&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="s2">&quot;Draw through&quot;</span><span class="p">,</span> <span class="s2">&quot;Blow through&quot;</span><span class="p">],</span>
                  <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;Draw through&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;Buildings.Fluid.Movers.SpeedControlled_y(m_flow_nominal=find_medium(.).rho_default / 3600 * find_parameters(V_flowSup_nominal))&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;icon_transformation&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
                  <span class="nt">&quot;placement&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">18</span><span class="p">]],</span>
                  <span class="nt">&quot;connect_tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;fluid_path&quot;</span><span class="p">:</span> <span class="s2">&quot;air_supply&quot;</span><span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;retFan&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Return/Relief fan&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;widget&quot;</span><span class="p">:</span> <span class="s2">&quot;Dropdown&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="s2">&quot;Return&quot;</span><span class="p">,</span> <span class="s2">&quot;Relief&quot;</span><span class="p">],</span>
                  <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;Relief&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;model&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="kc">null</span><span class="p">,</span>
                        <span class="s2">&quot;Buildings.Fluid.Movers.SpeedControlled_y(find_medium(.).rho_default / 3600 * find_parameters(V_flowRet_nominal))&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Buildings.Fluid.Movers.SpeedControlled_y(m_flow_nominal=find_medium(.).rho_default / 3600 * (find_parameters(V_flowRet_nominal) - find_parameters(V_flowSup_nominal) + find_parameters(V_flowOut_nominal)))&quot;</span>
                  <span class="p">],</span>
                  <span class="nt">&quot;icon_transformation&quot;</span><span class="p">:</span> <span class="s2">&quot;flipHorizontal&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;placement&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">18</span><span class="p">]],</span>
                  <span class="nt">&quot;connect_tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;fluid_path&quot;</span><span class="p">:</span> <span class="s2">&quot;air_return&quot;</span><span class="p">}</span>
            <span class="p">}</span>
      <span class="p">],</span>

      <span class="nt">&quot;controls&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Economizer&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;widget&quot;</span><span class="p">:</span> <span class="s2">&quot;Dropdown&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;condition&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="nt">&quot;#equipment[id=economizer].value&quot;</span><span class="p">:</span> <span class="s2">&quot;True&quot;</span><span class="p">}</span>
                  <span class="p">],</span>
                  <span class="nt">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ASHRAE 2006&quot;</span><span class="p">,</span> <span class="s2">&quot;ASHRAE G36&quot;</span><span class="p">]</span>
            <span class="p">}</span>
      <span class="p">],</span>

      <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;port_outAir&quot;</span><span class="p">,</span> <span class="s2">&quot;port_supAir&quot;</span><span class="p">],</span>
                  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Outside air port&quot;</span><span class="p">,</span> <span class="s2">&quot;Supply air port&quot;</span><span class="p">],</span>
                  <span class="nt">&quot;condition&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;NOT&quot;</span><span class="p">,</span>
                        <span class="p">{</span><span class="nt">&quot;#type&quot;</span><span class="p">:</span> <span class="s2">&quot;Exhaust Only&quot;</span><span class="p">},</span>
                  <span class="p">],</span>
                  <span class="nt">&quot;model&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Modelica.Fluid.Interfaces.FluidPort_a&quot;</span><span class="p">,</span> <span class="s2">&quot;Modelica.Fluid.Interfaces.FluidPort_b&quot;</span><span class="p">],</span>
                  <span class="nt">&quot;placement&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="mi">20</span><span class="p">]],</span>
                  <span class="nt">&quot;connect_tags&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;fluid_path&quot;</span><span class="p">:</span> <span class="s2">&quot;air_supply&quot;</span><span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;senFloOut&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Outdoor airflow measurement station&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;condition&quot;</span><span class="p">:</span> <span class="s2">&quot;conditioned by eco and controls&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;conditioned by eco and controls&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;placement&quot;</span><span class="p">:</span> <span class="s2">&quot;conditioned by eco and controls&quot;</span><span class="p">,</span>
            <span class="p">}</span>
      <span class="p">],</span>

      <span class="nt">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;V_flowSup_nominal&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Nominal supply air volumetric flow rate&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="nt">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;m3/h&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;condition&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;NOT&quot;</span><span class="p">,</span>
                        <span class="p">{</span><span class="nt">&quot;#type&quot;</span><span class="p">:</span> <span class="s2">&quot;Exhaust Only&quot;</span><span class="p">},</span>
                  <span class="p">],</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;V_flowRet_nominal&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Nominal return air volumetric flow rate&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="nt">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;m3/h&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;condition&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="s2">&quot;NOT&quot;</span><span class="p">,</span>
                        <span class="p">{</span><span class="nt">&quot;#type&quot;</span><span class="p">:</span> <span class="s2">&quot;Supply Only&quot;</span><span class="p">},</span>
                  <span class="p">],</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;V_flowOut_nominal&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Nominal outdoor air volumetric flow rate&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="nt">&quot;condition&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="nt">&quot;#equipment[id=eco].value&quot;</span><span class="p">:</span> <span class="s2">&quot;True&quot;</span><span class="p">}</span>
                  <span class="p">],</span>
                  <span class="nt">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;m3/h&quot;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;V_flowCooCoi_nominal&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Nominal outdoor air volumetric flow rate&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;V_flowSup_nominal&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;condition&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="nt">&quot;#equipment[name=cooCoi].value&quot;</span><span class="p">:</span> <span class="s2">&quot;Water&quot;</span><span class="p">}</span>
                  <span class="p">],</span>
                  <span class="nt">&quot;unit&quot;</span><span class="p">:</span> <span class="s2">&quot;m3/h&quot;</span>
            <span class="p">}</span>
      <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>The logic for instantiating classes from the library is straightforward. Each field of the form specifies:</p>
<ul class="simple">
<li><p>the path of the class to be instantiated depending on the user input;</p></li>
<li><p>the position of the component in simplified grid coordinates to be converted in diagram view coordinates.</p></li>
</ul>
<p>The next paragraphs address how the connections between the connectors of the different components are generated automatically based on this initial model structure.</p>
</div>
<div class="section" id="fluid-connectors">
<h3>4.4.2. Fluid Connectors<a class="headerlink" href="#fluid-connectors" title="Permalink to this headline">¶</a></h3>
<p>The fluid connections (<code class="docutils literal notranslate"><span class="pre">connect</span></code> equations involving two fluid connectors) are generated based on :</p>
<ul class="simple">
<li><p>the coordinates of the components in the diagram view,</p></li>
<li><p>a tag applied to the components’ connectors.</p></li>
</ul>
<p>That tag can be automatically generated for components with the two following fluid ports (most common case):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Modelica.Fluid.Interfaces.FluidPort_a</span></code>: inlet</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Modelica.Fluid.Interfaces.FluidPort_b</span></code>: outlet</p></li>
</ul>
<p>For components with more than two fluid ports e.g. coil, the variable name could be used:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Modelica.Fluid.Interfaces.FluidPort_a</span> <span class="pre">port_a1</span></code>: primary fluid (liquid) inlet</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Modelica.Fluid.Interfaces.FluidPort_a</span> <span class="pre">port_a2</span></code>: secondary fluid (air) inlet</p></li>
</ul>
<p>However that logic fails when the ports correspond to the same medium e.g.:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Buildings.Fluid.Actuators.Dampers.MixingBox</span></code>: <code class="docutils literal notranslate"><span class="pre">port_Out,</span> <span class="pre">port_Exh,</span> <span class="pre">port_Ret,</span> <span class="pre">port_Sup</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear</span></code>: <code class="docutils literal notranslate"><span class="pre">port_1,</span> <span class="pre">port_2,</span> <span class="pre">port_3</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Buildings.Fluid.HeatExchangers.PlateHeatExchangerEffectivenessNTU</span></code>: <code class="docutils literal notranslate"><span class="pre">port_a1,</span> <span class="pre">port_a2,</span> <span class="pre">port_b1,</span> <span class="pre">port_b2</span></code></p></li>
</ul>
<p>So the following logic is considered:</p>
<ol class="arabic">
<li><p>Default mode</p>
<blockquote>
<div><ul class="simple">
<li><p>By default <code class="docutils literal notranslate"><span class="pre">port_a</span></code> and <code class="docutils literal notranslate"><span class="pre">port_b</span></code> will be tagged as <code class="docutils literal notranslate"><span class="pre">inlet</span></code> and <code class="docutils literal notranslate"><span class="pre">outlet</span></code> respectively.</p></li>
<li><p>An optional tag is provided at the component level to specify the fluid path e.g. <code class="docutils literal notranslate"><span class="pre">air_supply</span></code> or <code class="docutils literal notranslate"><span class="pre">air_return</span></code>.</p></li>
<li><p>All fluid connectors are then tagged by concatenating the previous tags e.g. <code class="docutils literal notranslate"><span class="pre">air_supply_inlet</span></code> or <code class="docutils literal notranslate"><span class="pre">air_return_outlet</span></code>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Detailed mode</p>
<blockquote>
<div><ul>
<li><div class="line-block">
<div class="line">We need an additional mechanism to allow tagging each fluid port individually. Typically for a three way valve, the bypass port should be on a different fluid path than the inlet and outlet ports see <a class="reference internal" href="#linkage-connect-3wv"><span class="std std-numref">Fig. 4.5</span></a>. Hence we need a mapping dictionary at the connector level which, if provided, takes precedence on the default logic specified above.</div>
<div class="line">Furthermore a fluid connector can be connected to more than one other fluid connector. To support that feature another connector tag value is needed: <code class="docutils literal notranslate"><span class="pre">junction</span></code>.</div>
</div>
</li>
<li><p>For a three way valve without any flow splitter to explicitly model the fluid junction the mapping dictionary could be:</p>
<p><code class="docutils literal notranslate"><span class="pre">{&quot;port_1&quot;:</span> <span class="pre">&quot;hotwater_return_inlet&quot;,</span> <span class="pre">&quot;port_2&quot;:</span> <span class="pre">&quot;hotwater_return_outlet&quot;,</span> <span class="pre">&quot;port_3&quot;:</span> <span class="pre">&quot;hotwater_supply_junction&quot;}</span></code></p>
</li>
</ul>
</div></blockquote>
</li>
</ol>
<div class="figure align-default" id="linkage-connect-3wv">
<img alt="_images/linkage_connect_3wv.svg" src="_images/linkage_connect_3wv.svg" /><p class="caption"><span class="caption-number">Fig. 4.5 </span><span class="caption-text">Connection scheme with a fluid junction not modeled explicitly, using the connector tag <code class="docutils literal notranslate"><span class="pre">junction</span></code></span><a class="headerlink" href="#linkage-connect-3wv" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="linkage-connect-multi">
<img alt="_images/linkage_connect_multi.svg" src="_images/linkage_connect_multi.svg" /><p class="caption"><span class="caption-number">Fig. 4.6 </span><span class="caption-text">Connection scheme with a fluid junction not modeled explicitly, using a dedicated fluid path</span><a class="headerlink" href="#linkage-connect-multi" title="Permalink to this image">¶</a></p>
</div>
<p>The conversion script throws an exception if the instantiated class has some fluid ports that cannot be tagged with the previous logic e.g. non default names and no (or incomplete) mapping dictionary provided.</p>
<p>If the tagging is resolved for all fluid connectors of the instantiated objects the connector tags are stored in a hierarchical vendor annotation at the model level e.g. <code class="docutils literal notranslate"><span class="pre">__Linkage_connect(Tags(object_name1={connector_name1=air_supply_inlet,</span> <span class="pre">connector_name2=air_supply_outlet,</span> <span class="pre">...},</span> <span class="pre">...))</span></code>. This is done when updating the model.</p>
<p>All object names in <code class="docutils literal notranslate"><span class="pre">__Linkage_tags(Tags())</span></code> annotation reference instantiated objects with fluid ports that have to be connected to each other. To build the full connection set, two additional inputs are needed:</p>
<ol class="arabic">
<li><p>The names of the start port and the end port for each fluid path.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Those ports may be part of a different fluid path see <code class="docutils literal notranslate"><span class="pre">fluid_path1</span></code> in <a class="reference internal" href="#linkage-connect-multi"><span class="std std-numref">Fig. 4.6</span></a>.</p>
<p>Furthermore this a stringent limitation of that approach: if the structure of the model is complex, the start or end port of a specific fluid path can be hard to determine due to intricate boolean conditions. Allowing multiple tags for a single connector could be a better solution?</p>
</div>
</li>
<li><p>The direction (horizontal or vertical) of the connection path.</p></li>
</ol>
<p>Those inputs are stored in <code class="docutils literal notranslate"><span class="pre">__Linkage_connect(Direction(fluid_path1={start_connector_name,</span> <span class="pre">end_connector_name,</span> <span class="pre">horizontal_or_vertical}))</span></code>.</p>
<p>The connection logic is then as follows:</p>
<ul>
<li><p>List all the different fluid paths in <code class="docutils literal notranslate"><span class="pre">__Linkage_connect(Tags())</span></code> corresponding to each tuple <code class="docutils literal notranslate"><span class="pre">{fluid}_{path}</span></code> in all the connector tags <code class="docutils literal notranslate"><span class="pre">{fluid}_{path}_{port}</span></code>.</p></li>
<li><p>For each fluid path:</p>
<blockquote>
<div><ul>
<li><p>Find the position of the objects corresponding to the start and end ports specified in <code class="docutils literal notranslate"><span class="pre">__Linkage_connect(Direction(fluid_path1={start_connector_name,</span> <span class="pre">end_connector_name}))</span></code>. Those are further referred to as start and end position.</p></li>
<li><div class="line-block">
<div class="line">Find the orientation (up, down, right, left) of the direction (horizontal, vertical) of the connection path by comparing the <code class="docutils literal notranslate"><span class="pre">x</span></code> (resp. <code class="docutils literal notranslate"><span class="pre">y</span></code>) coordinate values of the start and end position if the direction is horizontal (resp. vertical).</div>
</div>
<div class="line-block">
<div class="line">Throw an exception if the orientation cannot be resolved due to identical coordinate values.</div>
</div>
</li>
<li><p>Order all the connectors belonging to that fluid path according to the orientation defined here above and based on the position of the corresponding objects with the constraint that for each object <code class="docutils literal notranslate"><span class="pre">inlet</span></code> has to be listed first and <code class="docutils literal notranslate"><span class="pre">outlet</span></code> last. Prepend / append that list with the start and end connectors.</p></li>
<li><p>Generate the <code class="docutils literal notranslate"><span class="pre">connect</span></code> equations by iterating on the ordered list of connectors as illustrated in the pseudo code below. And generate the connection path and the corresponding graphical annotation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ordered_connector</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;junction&quot;</span>
      <span class="k">while</span> <span class="nb">type</span><span class="p">(</span><span class="n">ordered_connector</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;junction&quot;</span>
            <span class="n">connect</span><span class="p">(</span><span class="n">ordered_connector</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ordered_connector</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="n">annotation</span><span class="p">(</span><span class="n">Line</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">create_new_path</span><span class="p">(</span><span class="n">ordered_connector</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ordered_connector</span><span class="p">[</span><span class="n">j</span><span class="p">])))</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="n">i</span> <span class="o">=</span> <span class="n">j</span>
<span class="k">else</span>
      <span class="n">connect</span><span class="p">(</span><span class="n">ordered_connector</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ordered_connector</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
      <span class="n">annotation</span><span class="p">(</span><span class="n">Line</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">create_new_path</span><span class="p">(</span><span class="n">ordered_connector</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ordered_connector</span><span class="p">[</span><span class="n">j</span><span class="p">])))</span>
      <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>The only valid connections are <code class="docutils literal notranslate"><span class="pre">junction</span></code> with <code class="docutils literal notranslate"><span class="pre">junction</span></code> and <code class="docutils literal notranslate"><span class="pre">outlet</span></code> with <code class="docutils literal notranslate"><span class="pre">inlet</span></code>: throw an exception otherwise.</p>
<p><a class="reference internal" href="#linkage-connect-junction"><span class="std std-numref">Fig. 4.7</span></a> further illustrates the logic for connecting <code class="docutils literal notranslate"><span class="pre">junction</span></code> ports.</p>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="figure align-default" id="linkage-connect-junction">
<img alt="_images/linkage_connect_junction.svg" src="_images/linkage_connect_junction.svg" /><p class="caption"><span class="caption-number">Fig. 4.7 </span><span class="caption-text">Logic of ports connection in case of <code class="docutils literal notranslate"><span class="pre">inlet</span></code> and <code class="docutils literal notranslate"><span class="pre">outlet</span></code> ports (top) and <code class="docutils literal notranslate"><span class="pre">junction</span></code> ports (bottom)</span><a class="headerlink" href="#linkage-connect-junction" title="Permalink to this image">¶</a></p>
</div>
<p>The implications of that logic are the following:</p>
<ul class="simple">
<li><p>Within the same fluid path, objects are connected in a given direction and orientation: to represent a fluid loop (graphically) at least two fluid paths must be defined, typically <code class="docutils literal notranslate"><span class="pre">supply</span></code> and <code class="docutils literal notranslate"><span class="pre">return</span></code>.</p></li>
<li><p>A same fluid path does not necessarily imply a uniform flow rate.</p></li>
<li><p>Among the multiple connectors which are part of the same junction, only one can have a paired <code class="docutils literal notranslate"><span class="pre">outlet</span></code> connector (part of the same component) within the same fluid path and the corresponding component must be placed further downstream. There is always the modeling alternative which consists in representing a junction by introducing a new fluid path as in <a class="reference internal" href="#linkage-connect-multi"><span class="std std-numref">Fig. 4.6</span></a>.</p></li>
</ul>
</div>
<div class="section" id="signal-connectors">
<h3>4.4.3. Signal Connectors<a class="headerlink" href="#signal-connectors" title="Permalink to this headline">¶</a></h3>
<p>Generating the <code class="docutils literal notranslate"><span class="pre">connect</span></code> equations for signal variables relies on string matching with the names of the variables declared in a a so-called <cite>control bus</cite> which has the type of an expandable connector type, see <em>§9.1.3
Expandable Connectors</em> in <a class="reference internal" href="bibliography.html#modelica2017" id="id6">[Mod17]</a>.</p>
<p>The following features of the expandable connector are leveraged:</p>
<ol class="arabic">
<li><p>All components in an expandable connector are seen as connector instances even if they are not declared as such. In comparison to a non expandable connector, that means that each variable (even of type <code class="docutils literal notranslate"><span class="pre">Real</span></code>) can be connected i.e. be part of a <code class="docutils literal notranslate"><span class="pre">connect</span></code> equation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Connecting a non connector variable to a connector variable with <code class="docutils literal notranslate"><span class="pre">connect(non_connector_var,</span> <span class="pre">connector_var)</span></code> yields a warning but not an error. It is considered bad practice though and a standard equation should be used in place <code class="docutils literal notranslate"><span class="pre">non_connector_var</span> <span class="pre">=</span> <span class="pre">connector_var</span></code>.</p></li>
<li><p>Using a <code class="docutils literal notranslate"><span class="pre">connect</span></code> equation allows to draw a connection line which makes the model structure explicit to the user. Furthermore it avoids mixing <code class="docutils literal notranslate"><span class="pre">connect</span></code> equations and standard equations within the same equation set, which has been adopted as a best practice in the Modelica Buildings library.</p></li>
</ul>
</div>
</li>
<li><p>The causality (input or output) of each variable inside an expandable connector is not predefined but rather set by the <code class="docutils literal notranslate"><span class="pre">connect</span></code> equation where the variable is first being used. For instance when a variable is first connected to an inside connector <code class="docutils literal notranslate"><span class="pre">Modelica.Blocks.Interfaces.RealOutput</span></code> it gets the same causality i.e. output. The same variable can then be connected to another inside connector  <code class="docutils literal notranslate"><span class="pre">Modelica.Blocks.Interfaces.RealInput</span></code>.</p></li>
<li><p>Possibly present but not connected variable is considered not declared: all variables need not be connected so the <cite>control bus</cite> does not have to be reconfigured depending on the model structure.</p></li>
<li><p>The variables set of a class of type expandable connector is expanded whenever a new variable gets connected to any <em>instance</em> of the class. Though that feature is not needed by the configuration widget (we will have a predefined <cite>control bus</cite> with declared variables corresponding to the control sequences implemented for each system), it is needed to allow the user further modifying the control sequence. Adding new control variables is simply done by connecting them to the <cite>control bus</cite>.</p></li>
</ol>
<p>Those features are illustrated with a minimal example in the figures below where:</p>
<ul class="simple">
<li><p>a controlled system consisting in a sensor (idealized with a real expression) and an actuator (idealized with a simple block passing through the value of the input control signal) is connected with,</p></li>
<li><p>a controller system which divides the input variable (measurement) by itself and outputs a control variable equal to one.</p></li>
<li><p>The same model is first implemented with an expandable connector and then with a standard connector.</p></li>
</ul>
<div class="figure align-default" id="bustestexp">
<a class="reference internal image-reference" href="_images/BusTestExp.svg"><img alt="_images/BusTestExp.svg" src="_images/BusTestExp.svg" width="50%" /></a>
<p class="caption"><span class="caption-number">Fig. 4.8 </span><span class="caption-text">Minimal example illustrating the connection scheme with an expandable connector – Top level</span><a class="headerlink" href="#bustestexp" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="kr">model</span> <span class="nc">BusTestExp</span>
<span class="n">BusTestControllerExp</span> <span class="n">controllerSystem</span><span class="p">;</span>
<span class="n">BusTestControlledExp</span> <span class="n">controlledSystem</span><span class="p">;</span>
<span class="kr">equation</span>
      <span class="kr">connect</span><span class="p">(</span><span class="n">controllerSystem</span><span class="o">.</span><span class="n">ahuBus</span><span class="p">,</span> <span class="n">controlledSystem</span><span class="o">.</span><span class="n">ahuBus</span><span class="p">);</span>
<span class="kr">end</span> <span class="nc">BusTestExp</span><span class="p">;</span>
</pre></div>
</div>
<div class="figure align-default" id="bustestcontrolledexp">
<a class="reference internal image-reference" href="_images/BusTestControlledExp.svg"><img alt="_images/BusTestControlledExp.svg" src="_images/BusTestControlledExp.svg" width="50%" /></a>
<p class="caption"><span class="caption-number">Fig. 4.9 </span><span class="caption-text">Minimal example illustrating the connection scheme with an expandable connector – Controlled component sublevel</span><a class="headerlink" href="#bustestcontrolledexp" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="kr">model</span> <span class="nc">BusTestControlledExp</span>
<span class="n">Modelica</span><span class="o">.</span><span class="n">Blocks</span><span class="o">.</span><span class="n">Sources</span><span class="o">.</span><span class="n">RealExpression</span> <span class="n">sensor</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">2</span> <span class="o">+</span> <span class="nb">sin</span><span class="p">(</span><span class="nb">time</span><span class="o">*</span><span class="mf">3.14</span><span class="p">));</span>
<span class="n">Buildings</span><span class="o">.</span><span class="n">Experimental</span><span class="o">.</span><span class="n">Templates</span><span class="o">.</span><span class="n">BaseClasses</span><span class="o">.</span><span class="n">AhuBus</span> <span class="n">ahuBus</span><span class="p">;</span>
<span class="n">Modelica</span><span class="o">.</span><span class="n">Blocks</span><span class="o">.</span><span class="n">Routing</span><span class="o">.</span><span class="n">RealPassThrough</span> <span class="n">actuator</span><span class="p">;</span>
<span class="kr">equation</span>
      <span class="kr">connect</span><span class="p">(</span><span class="n">sensor</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ahuBus</span><span class="o">.</span><span class="n">yMea</span><span class="p">);</span>
      <span class="kr">connect</span><span class="p">(</span><span class="n">ahuBus</span><span class="o">.</span><span class="n">yAct</span><span class="p">,</span> <span class="n">actuator</span><span class="o">.</span><span class="n">u</span><span class="p">);</span>
<span class="kr">end</span> <span class="nc">BusTestControlledExp</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="kr">expandable</span> <span class="kr">connector</span> <span class="nc">AhuBus</span>
<span class="kr">extends</span> <span class="n">Modelica</span><span class="o">.</span><span class="n">Icons</span><span class="o">.</span><span class="n">SignalBus</span><span class="p">;</span>
<span class="kr">end</span> <span class="nc">AhuBus</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The definition of <code class="docutils literal notranslate"><span class="pre">AhuBus</span></code> in the code snippet here above does not include any variable declaration. However the variables <code class="docutils literal notranslate"><span class="pre">ahuBus.yAct</span></code> and <code class="docutils literal notranslate"><span class="pre">ahuBus.yMea</span></code> are used in <code class="docutils literal notranslate"><span class="pre">connect</span></code> equations. That is only possible with an expandable connector.</p>
<p>For the configuration widget we will have predeclared variables with names allowing a one-to-one correspondence between:</p>
<ul class="simple">
<li><p>the control sequence input variables and the outputs of the equipment model e.g. measured quantities and actuators returned positions,</p></li>
<li><p>the control sequence output variables and the inputs of the equipment model e.g. actuators commanded positions.</p></li>
</ul>
<p>The control bus variables are used as “gateways” to stream values between the controlled and controller systems.</p>
<p>For clarity it might be useful to group control input variables in one sub-bus and control output variables in another sub-bus.
The <a class="reference external" href="https://www.claytex.com/blog/libraries/rationalisation-bus-sub-bus-signals-engines-library">experience feedback on bus usage in Modelica</a> shows that restricting the number of sub-buses and the use of bus variables to sensed and actuated signals only is a preferred option: the number of signals passing through busses has an impact on the number of equations and the simulation time.</p>
</div>
<div class="figure align-default" id="bustestcontrollerexp">
<a class="reference internal image-reference" href="_images/BusTestControllerExp.svg"><img alt="_images/BusTestControllerExp.svg" src="_images/BusTestControllerExp.svg" width="50%" /></a>
<p class="caption"><span class="caption-number">Fig. 4.10 </span><span class="caption-text">Minimal example illustrating the connection scheme with an expandable connector – Controller component sublevel</span><a class="headerlink" href="#bustestcontrollerexp" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="kr">model</span> <span class="nc">BusTestControlledExp</span>
      <span class="n">Modelica</span><span class="o">.</span><span class="n">Blocks</span><span class="o">.</span><span class="n">Sources</span><span class="o">.</span><span class="n">RealExpression</span> <span class="n">sensor</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">2</span> <span class="o">+</span> <span class="nb">sin</span><span class="p">(</span><span class="nb">time</span><span class="o">*</span><span class="mf">3.14</span><span class="p">));</span>
      <span class="n">Buildings</span><span class="o">.</span><span class="n">Experimental</span><span class="o">.</span><span class="n">Templates</span><span class="o">.</span><span class="n">BaseClasses</span><span class="o">.</span><span class="n">AhuBus</span> <span class="n">ahuBus</span><span class="p">;</span>
      <span class="n">Modelica</span><span class="o">.</span><span class="n">Blocks</span><span class="o">.</span><span class="n">Routing</span><span class="o">.</span><span class="n">RealPassThrough</span> <span class="n">actuator</span><span class="p">;</span>
<span class="kr">equation</span>
      <span class="kr">connect</span><span class="p">(</span><span class="n">ahuBus</span><span class="o">.</span><span class="n">yAct</span><span class="p">,</span> <span class="n">actuator</span><span class="o">.</span><span class="n">u</span><span class="p">);</span>
      <span class="kr">connect</span><span class="p">(</span><span class="n">sensor</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ahuBus</span><span class="o">.</span><span class="n">yMea</span><span class="p">)</span>
<span class="kr">end</span> <span class="nc">BusTestControlledExp</span><span class="p">;</span>
</pre></div>
</div>
<div class="figure align-default" id="bustestnonexp">
<a class="reference internal image-reference" href="_images/BusTestNonExp.svg"><img alt="_images/BusTestNonExp.svg" src="_images/BusTestNonExp.svg" width="50%" /></a>
<p class="caption"><span class="caption-number">Fig. 4.11 </span><span class="caption-text">Minimal example illustrating the connection scheme with a standard connector – Top level</span><a class="headerlink" href="#bustestnonexp" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="kr">model</span> <span class="nc">BusTestNonExp</span>
<span class="n">BusTestControllerNonExp</span> <span class="n">controllerSystem</span><span class="p">;</span>
<span class="n">BusTestControlledNonExp</span> <span class="n">controlledSystem</span><span class="p">;</span>
<span class="kr">equation</span>
      <span class="kr">connect</span><span class="p">(</span><span class="n">controllerSystem</span><span class="o">.</span><span class="n">nonExpandableBus</span><span class="p">,</span> <span class="n">controlledSystem</span><span class="o">.</span><span class="n">nonExpandableBus</span><span class="p">);</span>
<span class="kr">end</span> <span class="nc">BusTestNonExp</span><span class="p">;</span>
</pre></div>
</div>
<div class="figure align-default" id="bustestcontrollednonexp">
<a class="reference internal image-reference" href="_images/BusTestControlledNonExp.svg"><img alt="_images/BusTestControlledNonExp.svg" src="_images/BusTestControlledNonExp.svg" width="50%" /></a>
<p class="caption"><span class="caption-number">Fig. 4.12 </span><span class="caption-text">Minimal example illustrating the connection scheme with a standard connector – Controlled component sublevel</span><a class="headerlink" href="#bustestcontrollednonexp" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="kr">model</span> <span class="nc">BusTestControlledNonExp</span>
<span class="n">Modelica</span><span class="o">.</span><span class="n">Blocks</span><span class="o">.</span><span class="n">Sources</span><span class="o">.</span><span class="n">RealExpression</span> <span class="n">sensor</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">2</span> <span class="o">+</span> <span class="nb">sin</span><span class="p">(</span><span class="nb">time</span><span class="o">*</span><span class="mf">3.14</span><span class="p">));</span>
<span class="n">Modelica</span><span class="o">.</span><span class="n">Blocks</span><span class="o">.</span><span class="n">Routing</span><span class="o">.</span><span class="n">RealPassThrough</span> <span class="n">actuator</span><span class="p">;</span>
<span class="n">BaseClasses</span><span class="o">.</span><span class="n">NonExpandableBus</span> <span class="n">nonExpandableBus</span><span class="p">;</span>
<span class="kr">equation</span>
      <span class="n">nonExpandableBus</span><span class="o">.</span><span class="n">yMea</span> <span class="o">=</span> <span class="n">sensor</span><span class="o">.</span><span class="n">y</span><span class="p">;</span>
      <span class="n">actuator</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="n">nonExpandableBus</span><span class="o">.</span><span class="n">yAct</span><span class="p">;</span>
<span class="kr">end</span> <span class="nc">BusTestControlledNonExp</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="kr">connector</span> <span class="nc">NonExpandableBus</span>
<span class="c1">// The following declarations are required.</span>
<span class="c1">// The variables are not considered as connectors: they cannot be part of connect equations.</span>
<span class="nb">Real</span> <span class="n">yMea</span><span class="p">;</span>
<span class="nb">Real</span> <span class="n">yAct</span><span class="p">;</span>
<span class="kr">end</span> <span class="nc">NonExpandableBus</span><span class="p">;</span>
</pre></div>
</div>
<div class="figure align-default" id="bustestcontrollernonexp">
<a class="reference internal image-reference" href="_images/BusTestControllerNonExp.svg"><img alt="_images/BusTestControllerNonExp.svg" src="_images/BusTestControllerNonExp.svg" width="50%" /></a>
<p class="caption"><span class="caption-number">Fig. 4.13 </span><span class="caption-text">Minimal example illustrating the connection scheme with a standard connector – Controller component sublevel</span><a class="headerlink" href="#bustestcontrollernonexp" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="kr">model</span> <span class="nc">BusTestControllerNonExp</span>
<span class="n">Controls</span><span class="o">.</span><span class="n">OBC</span><span class="o">.</span><span class="n">CDL</span><span class="o">.</span><span class="n">Continuous</span><span class="o">.</span><span class="n">Division</span> <span class="n">controller</span><span class="p">;</span>
<span class="n">Modelica</span><span class="o">.</span><span class="n">Blocks</span><span class="o">.</span><span class="n">Routing</span><span class="o">.</span><span class="n">RealPassThrough</span> <span class="n">realPassThrough</span><span class="p">;</span>
<span class="n">BaseClasses</span><span class="o">.</span><span class="n">NonExpandableBus</span> <span class="n">nonExpandableBus</span><span class="p">;</span>
<span class="kr">equation</span>
      <span class="kr">connect</span><span class="p">(</span><span class="n">realPassThrough</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">controller</span><span class="o">.</span><span class="n">u1</span><span class="p">);</span>
      <span class="n">controller</span><span class="o">.</span><span class="n">u2</span> <span class="o">=</span> <span class="n">nonExpandableBus</span><span class="o">.</span><span class="n">yMea</span><span class="p">;</span>
      <span class="n">nonExpandableBus</span><span class="o">.</span><span class="n">yAct</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">y</span><span class="p">;</span>
      <span class="n">realPassThrough</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="n">nonExpandableBus</span><span class="o">.</span><span class="n">yMea</span><span class="p">;</span>
<span class="kr">end</span> <span class="nc">BusTestControllerNonExp</span><span class="p">;</span>
</pre></div>
</div>
<p>The algorithm is as follows:</p>
<ul class="simple">
<li></li>
</ul>
</div>
</div>
</div>
<div class="section" id="loading-a-modelica-model-with-linkagejs-annotations">
<h1>5. Loading a Modelica Model with LinkageJS Annotations<a class="headerlink" href="#loading-a-modelica-model-with-linkagejs-annotations" title="Permalink to this headline">¶</a></h1>
<p>Issue: the model might have been edited manually by the user.</p>
<ul class="simple">
<li><p>If some components are not found in Linkage annotations, the configuration widget is disabled.</p></li>
<li><p>Or we try to reconstruct the fluid paths based on the updated connection set and the existing Linkage annotations. Every new component gets included in the configuration data model (additional section).</p></li>
</ul>
</div>
<div class="section" id="questions">
<h1>6. Questions<a class="headerlink" href="#questions" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Similarities with <code class="docutils literal notranslate"><span class="pre">MapperClass</span></code> from URBANopt GeoJSON</p></li>
<li><p>Interface with OS measures</p></li>
<li><p>Interface with URBANopt GeoJSON</p></li>
<li><p>From OBC meeting on verification tool (9/10): generate <em>logical drawings</em></p></li>
<li><p>Form validation upon submit (export/generate) VS real-time</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Brick and tagging</p>
<p>Set up parameters values like OS measures enable cf. electrical loads…</p>
<p>From Taylor Eng.</p>
<p>For standard systems, it might be possible to simply include in their specifications a table of ASHRAE Guideline 36 sequences with check boxes for the paragraph numbers that are applicable to their project.</p>
<p>From <a class="reference external" href="https://build.openmodelica.org/Documentation/Modelica.Fluid.UsersGuide.ComponentDefinition.FluidConnectors.html">https://build.openmodelica.org/Documentation/Modelica.Fluid.UsersGuide.ComponentDefinition.FluidConnectors.html</a></p>
<p>With the current library design, it is necessary to explicitly select the medium model for each component in a circuit. This model is then propagated to the ports, and a Modelica translator will check that the quantity and unit attributes of connected interfaces are identical. Therefore, an error occurs, if connected FluidPorts do not have a medium with the same medium name. In the future, automatic propagation of fluid models through the ports will be introduced, but this still not possible with Modelica 3.0.</p>
</div>
</div>
<div class="section" id="to-do">
<h1>7. To Do<a class="headerlink" href="#to-do" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Test Modelica to JSON to Modelica on the whole library and run unit tests</p></li>
</ul>
</div>


    </div>
      
  </div>
</div>
  
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright (c) All rights reserved.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.<br/>
    </p>
  </div>
</footer>

  </body>
</html>