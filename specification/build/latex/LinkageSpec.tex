%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt, openany,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
  \ifdefined\DeclareUnicodeCharacterAsOptional
    \def\sphinxDUC#1{\DeclareUnicodeCharacter{"#1}}
  \else
    \let\sphinxDUC\DeclareUnicodeCharacter
  \fi
  \sphinxDUC{00A0}{\nobreakspace}
  \sphinxDUC{2500}{\sphinxunichar{2500}}
  \sphinxDUC{2502}{\sphinxunichar{2502}}
  \sphinxDUC{2514}{\sphinxunichar{2514}}
  \sphinxDUC{251C}{\sphinxunichar{251C}}
  \sphinxDUC{2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage[english]{babel}



\usepackage{times}
\expandafter\ifx\csname T@LGR\endcsname\relax
\else
% LGR was declared as font encoding
  \substitutefont{LGR}{\rmdefault}{cmr}
  \substitutefont{LGR}{\sfdefault}{cmss}
  \substitutefont{LGR}{\ttdefault}{cmtt}
\fi
\expandafter\ifx\csname T@X2\endcsname\relax
  \expandafter\ifx\csname T@T2A\endcsname\relax
  \else
  % T2A was declared as font encoding
    \substitutefont{T2A}{\rmdefault}{cmr}
    \substitutefont{T2A}{\sfdefault}{cmss}
    \substitutefont{T2A}{\ttdefault}{cmtt}
  \fi
\else
% X2 was declared as font encoding
  \substitutefont{X2}{\rmdefault}{cmr}
  \substitutefont{X2}{\sfdefault}{cmss}
  \substitutefont{X2}{\ttdefault}{cmtt}
\fi


\usepackage[Bjarne]{fncychap}
\usepackage[,numfigreset=1,mathnumfig]{sphinx}

\fvset{fontsize=\small}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}

\usepackage{sphinxmessages}
\setcounter{tocdepth}{2}


% The pdf output has too large picture compared to the html output.
% The next statement reduces the figure size
\pdfpxdimen=0.75\sphinxpxdimen

% Format of chapter fonts
\makeatletter
\ChNameVar{\raggedleft\sf\bfseries\Large} % sets the style for name
\ChNumVar{\raggedleft\sf\bfseries\Large} % sets the style for name
\ChTitleVar{\raggedleft\sf\bfseries\Large} % sets the style for name
\makeatother


\usepackage[scaled]{helvet}
\usepackage[helvet]{sfmath}

%% Fontsizes according to guideline from Andreas Eckmanns, Aug. 2018
\usepackage{sectsty}
\chapterfont{\fontsize{24}{26}\selectfont}
\sectionfont{\fontsize{14}{16}\selectfont}
\subsectionfont{\fontsize{12}{14}\selectfont}

%\usepackage[T1]{fontenc}
%%\titleformat*{\chapter}{\fontencoding{OT1}\fontfamily{cmr}\fontseries{m}%
%%  \fontshape{n}\fontsize{24pt}{24}\selectfont}
%%\titleformat*{\section}{\fontencoding{OT1}\fontfamily{cmr}\fontseries{m}%
%%  \fontshape{n}\fontsize{6pt}{6}\selectfont}
%%\titleformat*{\subsection}{\fontencoding{OT1}\fontfamily{cmr}\fontseries{m}%
%%  \fontshape{n}\fontsize{12pt}{12}\selectfont}
%%\titleformat*{\subsubsection}{\fontencoding{OT1}\fontfamily{cmr}\fontseries{m}%
%%  \fontshape{n}\fontsize{11pt}{11}\selectfont}
\titleformat*{\paragraph}
  {\rmfamily\slshape}
  {}{}{}
  \titlespacing{\paragraph}
  {0pc}{1.5ex minus .1 ex}{0pc}

\renewcommand\familydefault{\sfdefault}
\renewcommand{\baselinestretch}{1.1}


\usepackage{xcolor}
\definecolor{OldLace}{rgb}{0.99, 0.96, 0.9}
\definecolor{light-gray}{gray}{0.95}
\sphinxsetup{%
  verbatimwithframe=false,
  VerbatimColor={named}{light-gray},
%  TitleColor={named}{DarkGoldenrod},
%  hintBorderColor={named}{LightCoral},
  attentionborder=3pt,
%  attentionBorderColor={named}{Crimson},
%  attentionBgColor={named}{FloralWhite},
  noteborder=2pt,
  noteBorderColor={named}{light-gray},
  cautionborder=3pt,
%  cautionBorderColor={named}{Cyan},
%  cautionBgColor={named}{LightCyan}
}


\usepackage{sectsty}
\definecolor{lbl}{RGB}{2, 46, 77}
\chapterfont{\color{lbl}}  % sets colour of chapters
\sectionfont{\color{lbl}}  % sets colour of sections
\subsectionfont{\color{lbl}}  % sets colour of sections


% Reduce the list spacing
\usepackage{enumitem}
\setlist{nosep} % or \setlist{noitemsep} to leave space around whole list

% This allows adding :cite: in the label of figures.
% It is a work-around for https://github.com/mcmtroffaes/sphinxcontrib-bibtex/issues/92
\usepackage{etoolbox}
\AtBeginEnvironment{figure}{\renewcommand{\phantomsection}{}}



\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}}


\setcounter{secnumdepth}{3}
\usepackage{amssymb,amsmath}

% Figure and table caption in italic fonts
\makeatletter
\renewcommand{\fnum@figure}[1]{\small \textit{\figurename~\thefigure}: \it }
\renewcommand{\fnum@table}[1]{\small \textit{\tablename~\thetable}: \it }
\makeatother

% The next two lines patch the References title
\usepackage{etoolbox}
\patchcmd{\thebibliography}{\chapter*}{\phantom}{}{}

\definecolor{TitleColor}{rgb}{0 ,0 ,0} % black rathern than blue titles

\renewcommand{\Re}{{\mathbb R}}
\newcommand{\Na}{{\mathbb N}}
\newcommand{\Z}{{\mathbb Z}}

\usepackage{listings}
% see: http://mirror.aarnet.edu.au/pub/CTAN/macros/latex/contrib/listings/listings-1.3.pdf
\lstset{%
  basicstyle=\small, % print whole listing small
  keywordstyle=\color{red},
  identifierstyle=, % nothing happens
  commentstyle=\color{blue}, % white comments
  stringstyle=\color{OliveGreen}\it, % typewriter type for strings
  showstringspaces=false,
  numbers=left,
  numberstyle=\tiny,
  numbersep=5pt} % no special string space

\lstset{
    frame=single,
    breaklines=true,
    postbreak=\raisebox{0ex}[0ex][0ex]{\ensuremath{\color{red}\hookrightarrow\space}}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\lstdefinelanguage{Modelica}{%
  morekeywords={Thermal,HeatTransfer,Interfaces, flow, %
    SI,Temperature,HeatFlowRate,HeatPort},
  morecomment=[l]{//},
  morecomment=[s]{/*}{*/},
  morestring=[b]",
  emph={equation, partial, connector, model, public, end, %
    extends, parameter}, emphstyle=\color{blue},
}

\usepackage[margin=0.75in, includehead, includefoot, centering]{geometry}

% Replace the threeparttable as it causes the caption to
% be no wider than the table, which looks quite bad.
% Also, center the caption and table.
%\renewenvironment{threeparttable}{ \begin{table}\centering }{ \end{table} }
% Increase distance of caption
\belowcaptionskip=5pt


\pagestyle{normal}
\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}}
\fancyhf{}
\fancyhead[LE,RO]{\thepage}
\fancyhead[RE]{\leftmark}
\fancyhead[LO]{\rightmark}
\fancypagestyle{plain}{%
   \fancyhead{} % get rid of headers
   \fancyhead[R]{\leftmark}
   \fancyfoot[R]{\thepage}
   \fancyfoot[L]{}
   \renewcommand{\headrulewidth}{0.5pt} % and the line
}

%%\rfoot[LE,RO]{\thepage}
%%\renewcommand{\headrulewidth}{0.4pt}
%%\renewcommand{\footrulewidth}{0.4pt}

\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}}

\renewcommand{\chaptermark}[1]{\markboth{#1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}}

%\hypersetup{hidelinks = true} % Makefile enables this for the 2 page printout

% Set format of table of content. Otherwise, the titles stick to the page numbers in some cases
\usepackage[tocgraduated]{tocstyle}
\usetocstyle{nopagecolumn}
\usepackage{pdfpages}

\usepackage{tikz}
\usepackage{graphicx}
\usetikzlibrary{calc}



\title{LinkageJS Specification}
\date{Sep 09, 2019}
\release{}
\author{}
\newcommand{\sphinxlogo}{\sphinxincludegraphics{lbl-icon.png}\par}
\renewcommand{\releasename}{}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}


\pagestyle{plain}


\chapter{Preamble}
\label{\detokenize{preamble:preamble}}\label{\detokenize{preamble::doc}}

\section{Purpose of the Document}
\label{\detokenize{preamble:purpose-of-the-document}}
This document specifies the requirements for LinkageJS software.

The document is a working document that is used as a discussion basis and will evolve as the development progresses.
The proposed design should not be considered finalized.


\chapter{Conventions}
\label{\detokenize{conventions:conventions}}\label{\detokenize{conventions:sec-conventions}}\label{\detokenize{conventions::doc}}\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
We write a requirement \sphinxstyleemphasis{shall} be met if it must be fulfilled.
If the feature that implements a shall requirement is not in the final system,
then the system does not meet this requirement.
We write a requirement \sphinxstyleemphasis{should} be met if it is not critical
to the system working, but is still desirable.

\item {} 
Text in bracket such as “{[} … {]}” denotes informative text that is
not part of the specification.

\item {} 
Courier font names such as \sphinxcode{\sphinxupquote{input}} denote variables or statements used in computer code.

\end{enumerate}


\chapter{Process Workflow}
\label{\detokenize{process:process-workflow}}\label{\detokenize{process:sec-process}}\label{\detokenize{process::doc}}
a design engineer selects, configures, tests and evaluates the performance of a control sequence
using building energy simulation (2),
starting from a control sequence library that contains ASHRAE GPC 36 sequences,
as well as user-added sequences (3),
linked to a model of the mechanical system and the building (4).
If the sequences meet closed-loop performance requirements,
the designer exports a control specification,
including the sequences and functional verification tests expressed in
the Controls Description Language CDL (5).
Optionally, for reuse in similar projects,


\chapter{Requirements}
\label{\detokenize{requirements:requirements}}\label{\detokenize{requirements:sec-requirements}}\label{\detokenize{requirements::doc}}
This section describes the functional, mathematical and software requirements.


\section{General description}
\label{\detokenize{requirements:general-description}}
The software is a graphical user interface for editing Modelica models.
In this respect it must comply with the Modelica language specification \sphinxcite{bibliography:modelica2017} for every aspect relating to (the chapter numbers refer to \sphinxcite{bibliography:modelica2017}):
\begin{itemize}
\item {} 
validating the syntax of the user inputs: see \sphinxstyleemphasis{Chapter 2 Lexical Structure} and \sphinxstyleemphasis{Chapter 3 Operators and Expressions},

\item {} 
the connection between objects: see \sphinxstyleemphasis{Chapter 9 Connectors and Connections},

\item {} 
the structure of packages: see \sphinxstyleemphasis{Chapter 13 Packages},

\item {} 
\sphinxtitleref{to be updated}.

\end{itemize}


\subsection{Software Compatibility}
\label{\detokenize{requirements:software-compatibility}}

\begin{savenotes}\sphinxattablestart
\centering
\sphinxcapstartof{table}
\sphinxthecaptionisattop
\sphinxcaption{Requirements for software compatibility}\label{\detokenize{requirements:id6}}\label{\detokenize{requirements:tab-environment}}
\sphinxaftertopcaption
\begin{tabulary}{\linewidth}[t]{|T|T|}
\hline
\sphinxstyletheadfamily 
Feature
&\sphinxstyletheadfamily 
Support
\\
\hline
Platform (minimum version)
&
Windows (10), Linux Ubuntu (16.04), OS X (10.10)
\\
\hline
Web browser
&
Chrome, Firefox, Safari
\\
\hline
Offline version
&
Running on local server with access to resources hosted on the file system
\\
\hline
\end{tabulary}
\par
\sphinxattableend\end{savenotes}


\section{Modelica Graphical User Interface}
\label{\detokenize{requirements:modelica-graphical-user-interface}}

\subsection{Structure}
\label{\detokenize{requirements:structure}}
See figure \hyperref[\detokenize{requirements:screen-conf-1}]{Fig.\@ \ref{\detokenize{requirements:screen-conf-1}}}:
\begin{itemize}
\item {} 
Left panel: library navigator

\item {} 
Main panel: diagram view of the model

\item {} 
Right panel:
\begin{itemize}
\item {} 
Configuration widget

\item {} 
Connection widget

\item {} 
Annotation widget

\item {} 
Parameters widget

\end{itemize}

\item {} 
Menu bar

\item {} 
Bottom panel: console

\end{itemize}


\subsection{Functionalities}
\label{\detokenize{requirements:functionalities}}

\begin{savenotes}\sphinxattablestart
\centering
\sphinxcapstartof{table}
\sphinxthecaptionisattop
\sphinxcaption{Functionalities of the user interface \textendash{} R: required, P: required partially, O: optional, N: not required}\label{\detokenize{requirements:id7}}\label{\detokenize{requirements:tab-gui-func}}
\sphinxaftertopcaption
\begin{tabular}[t]{|\X{40}{180}|\X{20}{180}|\X{20}{180}|\X{100}{180}|}
\hline
\sphinxstyletheadfamily 
Feature
&\sphinxstyletheadfamily 
V0
&\sphinxstyletheadfamily 
V1
&\sphinxstyletheadfamily 
Comment
\\
\hline
\sphinxstylestrong{I/O}
&&&\\
\hline
Load \sphinxcode{\sphinxupquote{mo}} file
&
R
&&
Simple Modelica model or full package
\\
\hline
Translate model
&
P
&&
The software settings allow the user to specify a command for translating the model with a third party Modelica tool e.g. JModelica.
\\
\hline
Simulate model
&
P
&&
The software settings allow the user to specify a command for simulating the model with a third party Modelica tool e.g. JModelica.
\\
\hline
Export simulation results
&
R
&&
Export in the following format: \sphinxcode{\sphinxupquote{mat, csv}}
\\
\hline
Variables browser
&
P
&
R
&
Query selection of model variables based on regular expression (V0) or Brick tag \sphinxcite{bibliography:brick} (V1)
\\
\hline
Plot simulation results
&
N
&
O
&\\
\hline
Text editor
&
N
&
O
&\\
\hline
\sphinxstylestrong{Object manipulation}
&&&\\
\hline
Vectorized instances
&
R
&&\\
\hline
Expandable connectors
&
R
&&\\
\hline
Navigation in object composition
&
R
&&
Right clicking an icon in the diagram view offers the option to open the model in another tab
\\
\hline
\sphinxstylestrong{Graphical features}
&&&\\
\hline
Support of Modelica graphical annotations
&
R
&&\\
\hline
Icon layer
&
O
&
O
&\\
\hline
Draw shape, text box
&
O
&
R
&\\
\hline
Customize connection lines
&
O
&
R
&
Color, width and line can be specified in the \sphinxtitleref{Annotation Panel}
\\
\hline
Hover information
&
R
&&
Class path when hovering an object in the diagram view and tooltip for each GUI element
\\
\hline
\end{tabular}
\par
\sphinxattableend\end{savenotes}


\subsection{Generating Connections}
\label{\detokenize{requirements:generating-connections}}
When drawing a connection line between two connector icons:
\begin{itemize}
\item {} 
a \sphinxcode{\sphinxupquote{connect}} equation with the references to the two connectors is created,

\item {} 
with a graphical annotation defining the connection path as an array of points and providing an optional smoothing function e.g. Bezier.
\begin{itemize}
\item {} 
When no smoothing function is specified the connection path must be rendered graphically as a set of segments.

\item {} 
The array of points is either:
\begin{itemize}
\item {} 
created fully automatically when the next user’s click after having started a connection is made on a connector icon. The function call \sphinxcode{\sphinxupquote{create\_new\_path(connector1, connector2)}} creates the minimum number of \sphinxstyleemphasis{vertical or horizontal} segments to link the two connector icons with the constraint of avoiding overlaying any instantiated object,

\item {} 
created semi automatically based on the input points corresponding to the user clicks outside any connector icon: the function call \sphinxcode{\sphinxupquote{create\_new\_path(point{[}i{]}, point{[}i+1{]})}} is called to generate the path linking each pair of points together.

\end{itemize}

\end{itemize}

\end{itemize}


\section{Configuration Widget}
\label{\detokenize{requirements:configuration-widget}}

\subsection{Functionalities}
\label{\detokenize{requirements:id4}}
The configuration widget allows the user to generate a model of an HVAC system by filling up a simple form.

The form is provided by the developer as a JSON file or a dictionary within a Python script (easier to program the modeling logic).
It provides for each field:
\begin{itemize}
\item {} 
the HTML widget and populating data to be used for user input,

\item {} 
the modeling data required to instantiate, position and set up the parameters of the different components,

\item {} 
some tags to be used to automatically generate the connections between the different components connectors.

\end{itemize}

The user interface logic is illustrated in figures \hyperref[\detokenize{requirements:screen-conf-0}]{Fig.\@ \ref{\detokenize{requirements:screen-conf-0}}} and \hyperref[\detokenize{requirements:screen-conf-1}]{Fig.\@ \ref{\detokenize{requirements:screen-conf-1}}}.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{screen_conf_0}.pdf}
\caption{Configuration widget \textendash{} Configuring a new model}\label{\detokenize{requirements:id8}}\label{\detokenize{requirements:screen-conf-0}}\end{figure}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{screen_conf_1}.pdf}
\caption{Configuration widget \textendash{} Configuring an existing model}\label{\detokenize{requirements:id9}}\label{\detokenize{requirements:screen-conf-1}}\end{figure}

The envisioned schema supporting this logic is illustrated in \hyperref[\detokenize{requirements:code-conf-ahu}]{Listing \ref{\detokenize{requirements:code-conf-ahu}}} where:
\begin{itemize}
\item {} 
the components referenced under the \sphinxcode{\sphinxupquote{equipment}} name are connected together in one dedicated equipment model,

\item {} 
the components referenced under the \sphinxcode{\sphinxupquote{controls}} name are connected together in one dedicated controls model,

\item {} 
the equipment and controls models are connected together by means of a \sphinxtitleref{control bus}, see \hyperref[\detokenize{requirements:bustestexp}]{Fig.\@ \ref{\detokenize{requirements:bustestexp}}}.

\end{itemize}
\sphinxSetupCaptionForVerbatim{Partial example of the configuration data model for an air handling unit}
\def\sphinxLiteralBlockLabel{\label{\detokenize{requirements:code-conf-ahu}}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\PYGZob{}}
      \PYG{n+nt}{\PYGZdq{}system\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}
            \PYG{n+nt}{\PYGZdq{}description\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}System type\PYGZdq{}}\PYG{p}{,}
            \PYG{n+nt}{\PYGZdq{}value\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}AHU\PYGZdq{}}
      \PYG{p}{\PYGZcb{}}\PYG{p}{,}

      \PYG{n+nt}{\PYGZdq{}icon\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}path of icon.mo\PYGZdq{}}\PYG{p}{,}

      \PYG{n+nt}{\PYGZdq{}diagram\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}
            \PYG{n+nt}{\PYGZdq{}configuration\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{l+m+mi}{20}\PYG{p}{]}\PYG{p}{,}
            \PYG{n+nt}{\PYGZdq{}modelica\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{p}{[}\PYG{l+m+mi}{\PYGZhy{}120}\PYG{p}{,}\PYG{l+m+mi}{\PYGZhy{}200}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{120}\PYG{p}{,}\PYG{l+m+mi}{120}\PYG{p}{]}\PYG{p}{]}
      \PYG{p}{\PYGZcb{}}\PYG{p}{,}

      \PYG{n+nt}{\PYGZdq{}name\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}
            \PYG{n+nt}{\PYGZdq{}description\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Model name\PYGZdq{}}\PYG{p}{,}
            \PYG{n+nt}{\PYGZdq{}widget\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Text\PYGZdq{}}\PYG{p}{,}
            \PYG{n+nt}{\PYGZdq{}value\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}AHU\PYGZus{}\PYGZsh{}i\PYGZdq{}}
      \PYG{p}{\PYGZcb{}}\PYG{p}{,}

      \PYG{n+nt}{\PYGZdq{}type\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}
            \PYG{n+nt}{\PYGZdq{}description\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Type of AHU\PYGZdq{}}\PYG{p}{,}
            \PYG{n+nt}{\PYGZdq{}widget\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Dropdown\PYGZdq{}}\PYG{p}{,}
            \PYG{n+nt}{\PYGZdq{}options\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}VAV\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}DOA\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}Supply Only\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}Exhaust Only\PYGZdq{}}\PYG{p}{]}
      \PYG{p}{\PYGZcb{}}\PYG{p}{,}

      \PYG{n+nt}{\PYGZdq{}fluid\PYGZus{}path\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}
            \PYG{n+nt}{\PYGZdq{}air\PYGZus{}supply\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}
                  \PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}start\PYGZus{}port\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}port\PYGZus{}outAir\PYGZdq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
                  \PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}end\PYGZus{}port\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}port\PYGZus{}supAir\PYGZdq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
                  \PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}direction\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}horizontal\PYGZdq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
                  \PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}medium\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Buildings.Media.Air\PYGZdq{}}\PYG{p}{\PYGZcb{}}
            \PYG{p}{]}
      \PYG{p}{\PYGZcb{}}\PYG{p}{,}

      \PYG{n+nt}{\PYGZdq{}equipment\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}
            \PYG{p}{\PYGZob{}}
                  \PYG{n+nt}{\PYGZdq{}name\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}port\PYGZus{}outAir\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}port\PYGZus{}supAir\PYGZdq{}}\PYG{p}{]}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}description\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}Outside air port\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}Supply air port\PYGZdq{}}\PYG{p}{]}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}condition\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}
                        \PYG{l+s+s2}{\PYGZdq{}NOT\PYGZdq{}}\PYG{p}{,}
                        \PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}\PYGZsh{}type\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Exhaust Only\PYGZdq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
                  \PYG{p}{]}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}model\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}Modelica.Fluid.Interfaces.FluidPort\PYGZus{}a\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}Modelica.Fluid.Interfaces.FluidPort\PYGZus{}b\PYGZdq{}}\PYG{p}{]}
                  \PYG{l+s+s2}{\PYGZdq{}placement\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{p}{[}\PYG{l+m+mi}{12}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{12}\PYG{p}{,}\PYG{l+m+mi}{20}\PYG{p}{]}\PYG{p}{]}
                  \PYG{l+s+s2}{\PYGZdq{}connect\PYGZus{}tags\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}fluid\PYGZus{}path\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}air\PYGZus{}supply\PYGZdq{}}\PYG{p}{\PYGZcb{}}
            \PYG{p}{\PYGZcb{}}\PYG{p}{,}
            \PYG{p}{\PYGZob{}}
                  \PYG{n+nt}{\PYGZdq{}name\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}heaRec\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}description\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Heat recovery\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}widget\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Dropdown\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}condition\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}
                        \PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}\PYGZsh{}type\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}DOA\PYGZdq{}}\PYG{p}{\PYGZcb{}}
                  \PYG{p}{]}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}options\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}None\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}Fixed plate\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}Enthalpy wheel\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}Sensible wheel\PYGZdq{}}\PYG{p}{]}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}value\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}None\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}model\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}
                        \PYG{k+kc}{null}\PYG{p}{,}
                        \PYG{l+s+s2}{\PYGZdq{}Buildings.Fluid.HeatExchangers.PlateHeatExchangerEffectivenessNTU\PYGZdq{}}\PYG{p}{,}
                        \PYG{l+s+s2}{\PYGZdq{}Buildings.Fluid.HeatExchangers.EnthalpyWheel\PYGZdq{}}\PYG{p}{,}
                        \PYG{l+s+s2}{\PYGZdq{}Buildings.Fluid.HeatExchangers.EnthalpyWheel(sensible=true)\PYGZdq{}}
                  \PYG{p}{]}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}icon\PYGZus{}transformation\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}flipHorizontal\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}placement\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{12}\PYG{p}{,} \PYG{l+m+mi}{9}\PYG{p}{]}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}connect\PYGZus{}tags\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}connectors\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}
                        \PYG{n+nt}{\PYGZdq{}port\PYGZus{}a1\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}air\PYGZus{}return\PYGZus{}inlet\PYGZdq{}}\PYG{p}{,} \PYG{n+nt}{\PYGZdq{}port\PYGZus{}a2\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}air\PYGZus{}supply\PYGZus{}inlet\PYGZdq{}}\PYG{p}{,} \PYG{n+nt}{\PYGZdq{}port\PYGZus{}b1\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}air\PYGZus{}return\PYGZus{}outlet\PYGZdq{}}\PYG{p}{,} \PYG{n+nt}{\PYGZdq{}port\PYGZus{}b2\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}air\PYGZus{}supply\PYGZus{}outlet\PYGZdq{}}
                  \PYG{p}{\PYGZcb{}}\PYG{p}{\PYGZcb{}}
            \PYG{p}{\PYGZcb{}}\PYG{p}{,}
            \PYG{p}{\PYGZob{}}
                  \PYG{n+nt}{\PYGZdq{}name\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}eco\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}description\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Economizer\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}widget\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Dropdown\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}options\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}None\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}Separate dedicated OA dampers\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}Single common OA damper\PYGZdq{}}\PYG{p}{]}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}condition\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}
                        \PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}\PYGZsh{}type\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}VAV\PYGZdq{}}\PYG{p}{\PYGZcb{}}
                  \PYG{p}{]}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}model\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}
                        \PYG{k+kc}{null}\PYG{p}{,}
                        \PYG{l+s+s2}{\PYGZdq{}Buildings.Fluid.Actuators.Dampers.MixingBoxMinimumFlow\PYGZdq{}}\PYG{p}{,}
                        \PYG{l+s+s2}{\PYGZdq{}Buildings.Fluid.Actuators.Dampers.MixingBox\PYGZdq{}}
                  \PYG{p}{]}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}icon\PYGZus{}transformation\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}flipVertical\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}placement\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{12}\PYG{p}{,} \PYG{l+m+mi}{6}\PYG{p}{]}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}connect\PYGZus{}tags\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}connectors\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}
                        \PYG{n+nt}{\PYGZdq{}port\PYGZus{}Out\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}air\PYGZus{}supply\PYGZus{}junction\PYGZdq{}}\PYG{p}{,} \PYG{n+nt}{\PYGZdq{}port\PYGZus{}OutMin\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}air\PYGZus{}supply\PYGZus{}junction\PYGZdq{}}\PYG{p}{,} \PYG{n+nt}{\PYGZdq{}port\PYGZus{}Sup\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}air\PYGZus{}supply\PYGZus{}outlet\PYGZdq{}}\PYG{p}{,}
                        \PYG{n+nt}{\PYGZdq{}port\PYGZus{}Exh\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}air\PYGZus{}return\PYGZus{}outlet\PYGZdq{}}\PYG{p}{,} \PYG{n+nt}{\PYGZdq{}port\PYGZus{}Ret\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}air\PYGZus{}return\PYGZus{}inlet\PYGZdq{}}
                  \PYG{p}{\PYGZcb{}}\PYG{p}{\PYGZcb{}}
            \PYG{p}{\PYGZcb{}}\PYG{p}{,}
            \PYG{p}{\PYGZob{}}
                  \PYG{n+nt}{\PYGZdq{}name\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}supFan\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}description\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Supply fan\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}widget\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Dropdown\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}options\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}None\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}Draw through\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}Blow through\PYGZdq{}}\PYG{p}{]}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}value\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Draw through\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}model\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Buildings.Fluid.Movers.SpeedControlled\PYGZus{}y\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}icon\PYGZus{}transformation\PYGZdq{}}\PYG{p}{:} \PYG{k+kc}{null}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}placement\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{k+kc}{null}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{16}\PYG{p}{,} \PYG{l+m+mi}{11}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{16}\PYG{p}{,} \PYG{l+m+mi}{18}\PYG{p}{]}\PYG{p}{]}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}connect\PYGZus{}tags\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}fluid\PYGZus{}path\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}air\PYGZus{}supply\PYGZdq{}}\PYG{p}{\PYGZcb{}}
            \PYG{p}{\PYGZcb{}}\PYG{p}{,}
            \PYG{p}{\PYGZob{}}
                  \PYG{n+nt}{\PYGZdq{}name\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}retFan\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}description\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Return/Relief fan\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}widget\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Dropdown\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}options\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}None\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}Return\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}Relief\PYGZdq{}}\PYG{p}{]}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}value\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Relief\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}model\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Buildings.Fluid.Movers.SpeedControlled\PYGZus{}y\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}icon\PYGZus{}transformation\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}flipHorizontal\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}placement\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{k+kc}{null}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{16}\PYG{p}{,} \PYG{l+m+mi}{11}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{16}\PYG{p}{,} \PYG{l+m+mi}{18}\PYG{p}{]}\PYG{p}{]}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}connect\PYGZus{}tags\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}fluid\PYGZus{}path\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}air\PYGZus{}return\PYGZdq{}}\PYG{p}{\PYGZcb{}}
            \PYG{p}{\PYGZcb{}}
      \PYG{p}{]}\PYG{p}{,}

      \PYG{n+nt}{\PYGZdq{}controls\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}

            \PYG{p}{\PYGZob{}}
                  \PYG{n+nt}{\PYGZdq{}description\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Economizer\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}widget\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Dropdown\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}condition\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}
                        \PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}\PYGZsh{}equipment[id=economizer].value\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}True\PYGZdq{}}\PYG{p}{\PYGZcb{}}
                  \PYG{p}{]}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}options\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}ASHRAE 2006\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}ASHRAE G36\PYGZdq{}}\PYG{p}{]}
            \PYG{p}{\PYGZcb{}}
      \PYG{p}{]}\PYG{p}{,}

      \PYG{n+nt}{\PYGZdq{}parameters\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}
            \PYG{p}{\PYGZob{}}
                  \PYG{n+nt}{\PYGZdq{}name\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}V\PYGZus{}flowSup\PYGZus{}nominal\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}description\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Nominal supply air volumetric flow rate\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}value\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{0}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}unit\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}m3/h\PYGZdq{}}
            \PYG{p}{\PYGZcb{}}\PYG{p}{,}
            \PYG{p}{\PYGZob{}}
                  \PYG{n+nt}{\PYGZdq{}name\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}V\PYGZus{}flowRet\PYGZus{}nominal\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}description\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Nominal return air volumetric flow rate\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}value\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{0}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}unit\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}m3/h\PYGZdq{}}
            \PYG{p}{\PYGZcb{}}
            \PYG{p}{\PYGZob{}}
                  \PYG{n+nt}{\PYGZdq{}name\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}V\PYGZus{}flowOut\PYGZus{}nominal\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}description\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}Nominal outdoor air volumetric flow rate\PYGZdq{}}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}value\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{0}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}condition\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}
                        \PYG{p}{\PYGZob{}}\PYG{n+nt}{\PYGZdq{}\PYGZsh{}equipment[id=economizer].value\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}True\PYGZdq{}}\PYG{p}{\PYGZcb{}}
                  \PYG{p}{]}\PYG{p}{,}
                  \PYG{n+nt}{\PYGZdq{}unit\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}m3/h\PYGZdq{}}
            \PYG{p}{\PYGZcb{}}
      \PYG{p}{]}
\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}

The logic for instantiating classes from the library is straightforward. Each field of the form specifies:
\begin{itemize}
\item {} 
the path of the class to be instantiated depending on the user input (note that some classes e.g. \sphinxcode{\sphinxupquote{FluidPort}} can be instantiated as dependencies of others and have no corresponding input in the form);

\item {} 
the position of the component in simplified grid coordinates to be converted in diagram view coordinates.

\end{itemize}

The next paragraphs address how the connections between the connectors of the different components have to be generated automatically based on the model structure.


\subsection{Fluid Connectors}
\label{\detokenize{requirements:fluid-connectors}}
The fluid connections (\sphinxcode{\sphinxupquote{connect}} equations involving two fluid connectors) are generated based on :
\begin{itemize}
\item {} 
the coordinates of the components in the diagram view,

\item {} 
a tag applied to the components’ connectors.

\end{itemize}

That tag can be automatically generated for components with the two following fluid ports (most common case):
\begin{itemize}
\item {} 
\sphinxcode{\sphinxupquote{Modelica.Fluid.Interfaces.FluidPort\_a}}: inlet

\item {} 
\sphinxcode{\sphinxupquote{Modelica.Fluid.Interfaces.FluidPort\_b}}: outlet

\end{itemize}

For components with more than two fluid ports e.g. coil, the variable name could be used:
\begin{itemize}
\item {} 
\sphinxcode{\sphinxupquote{Modelica.Fluid.Interfaces.FluidPort\_a port\_a1}}: primary fluid (liquid) inlet

\item {} 
\sphinxcode{\sphinxupquote{Modelica.Fluid.Interfaces.FluidPort\_a port\_a2}}: secondary fluid (air) inlet

\end{itemize}

However that logic fails when the ports correspond to the same medium e.g.:
\begin{itemize}
\item {} 
\sphinxcode{\sphinxupquote{Buildings.Fluid.Actuators.Dampers.MixingBox}}: \sphinxcode{\sphinxupquote{port\_Out, port\_Exh, port\_Ret, port\_Sup}}

\item {} 
\sphinxcode{\sphinxupquote{Buildings.Fluid.Actuators.Valves.ThreeWayEqualPercentageLinear}}: \sphinxcode{\sphinxupquote{port\_1, port\_2, port\_3}}

\item {} 
\sphinxcode{\sphinxupquote{Buildings.Fluid.HeatExchangers.PlateHeatExchangerEffectivenessNTU}}: \sphinxcode{\sphinxupquote{port\_a1, port\_a2, port\_b1, port\_b2}}

\end{itemize}

So the following logic is considered:
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
Default mode
\begin{itemize}
\item {} 
By default \sphinxcode{\sphinxupquote{port\_a}} and \sphinxcode{\sphinxupquote{port\_b}} will be tagged as \sphinxcode{\sphinxupquote{inlet}} and \sphinxcode{\sphinxupquote{outlet}} respectively.

\item {} 
An optional tag is provided at the component level to specify the fluid path e.g. \sphinxcode{\sphinxupquote{air\_supply}} or \sphinxcode{\sphinxupquote{air\_return}}.

\item {} 
All fluid connectors are then tagged by concatenating the previous tags e.g. \sphinxcode{\sphinxupquote{air\_supply\_inlet}} or \sphinxcode{\sphinxupquote{air\_return\_outlet}}.

\end{itemize}

\item {} 
Detailed mode
\begin{itemize}
\item {} 
\begin{DUlineblock}{0em}
\item[] We need an additional mechanism to allow tagging each fluid port individually. Typically for a three way valve, the bypass port should be on a different fluid path than the inlet and outlet ports see \hyperref[\detokenize{requirements:linkage-connect-3wv}]{Fig.\@ \ref{\detokenize{requirements:linkage-connect-3wv}}}. Hence we need a mapping dictionary at the connector level which, if provided, takes precedence on the default logic specified above.
\item[] Furthermore a fluid connector can be connected to more than one other fluid connector. To support that feature another connector tag value is needed: \sphinxcode{\sphinxupquote{junction}}.
\end{DUlineblock}

\item {} 
For a three way valve without any flow splitter to explicitly model the fluid junction the mapping dictionary could be:

\sphinxcode{\sphinxupquote{\{"port\_1": "hotwater\_return\_inlet", "port\_2": "hotwater\_return\_outlet", "port\_3": "hotwater\_supply\_junction"\}}}

\end{itemize}

\end{enumerate}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{linkage_connect_3wv}.pdf}
\caption{Connection scheme with a fluid junction not modeled explicitly, using the connector tag \sphinxcode{\sphinxupquote{junction}}}\label{\detokenize{requirements:linkage-connect-3wv}}\end{figure}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{linkage_connect_multi}.pdf}
\caption{Connection scheme with a fluid junction not modeled explicitly, using a dedicated fluid path}\label{\detokenize{requirements:linkage-connect-multi}}\end{figure}

The conversion script throws an exception if the instantiated class has some fluid ports that cannot be tagged with the previous logic e.g. non default names and no (or incomplete) mapping dictionary provided.

If the tagging is resolved for all fluid connectors of the instantiated objects the connector tags are stored in a hierarchical vendor annotation at the model level e.g. \sphinxcode{\sphinxupquote{\_\_Linkage\_connect(Tags(object\_name1=\{connector\_name1=air\_supply\_inlet, connector\_name2=air\_supply\_outlet, ...\}, ...))}}. This is done when updating the model.

All object names in \sphinxcode{\sphinxupquote{\_\_Linkage\_tags(Tags())}} annotation reference instantiated objects with fluid ports that have to be connected to each other. To build the full connection set, two additional inputs are needed:
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
The names of the start port and the end port for each fluid path.

\begin{sphinxadmonition}{note}{Note:}
Those ports may be part of a different fluid path see \sphinxcode{\sphinxupquote{fluid\_path1}} in \hyperref[\detokenize{requirements:linkage-connect-multi}]{Fig.\@ \ref{\detokenize{requirements:linkage-connect-multi}}}.

Furthermore this a stringent limitation of that approach: if the structure of the model is complex, the start or end port of a specific fluid path can be hard to determine due to intricate boolean conditions. Allowing multiple tags for a single connector could be a better solution?
\end{sphinxadmonition}

\item {} 
The direction (horizontal or vertical) of the connection path.

\end{enumerate}

Those inputs are stored in \sphinxcode{\sphinxupquote{\_\_Linkage\_connect(Direction(fluid\_path1=\{start\_connector\_name, end\_connector\_name, horizontal\_or\_vertical\}))}}.

The connection logic is then as follows:
\begin{itemize}
\item {} 
List all the different fluid paths in \sphinxcode{\sphinxupquote{\_\_Linkage\_connect(Tags())}} corresponding to each tuple \sphinxcode{\sphinxupquote{\{fluid\}\_\{path\}}} in all the connector tags \sphinxcode{\sphinxupquote{\{fluid\}\_\{path\}\_\{port\}}}.

\item {} 
For each fluid path:
\begin{itemize}
\item {} 
Find the position of the objects corresponding to the start and end ports specified in \sphinxcode{\sphinxupquote{\_\_Linkage\_connect(Direction(fluid\_path1=\{start\_connector\_name, end\_connector\_name\}))}}. Those are further referred to as start and end position.

\item {} 
\begin{DUlineblock}{0em}
\item[] Find the orientation (up, down, right, left) of the direction (horizontal, vertical) of the connection path by comparing the \sphinxcode{\sphinxupquote{x}} (resp. \sphinxcode{\sphinxupquote{y}}) coordinate values of the start and end position if the direction is horizontal (resp. vertical).
\end{DUlineblock}

\begin{DUlineblock}{0em}
\item[] Throw an exception if the orientation cannot be resolved due to identical coordinate values.
\end{DUlineblock}

\item {} 
Order all the connectors belonging to that fluid path according to the orientation defined here above and based on the position of the corresponding objects with the constraint that for each object \sphinxcode{\sphinxupquote{inlet}} has to be listed first and \sphinxcode{\sphinxupquote{outlet}} last. Prepend / append that list with the start and end connectors.

\item {} 
Generate the \sphinxcode{\sphinxupquote{connect}} equations by iterating on the ordered list of connectors as illustrated in the pseudo code below. And generate the connection path and the corresponding graphical annotation:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{i} \PYG{o}{=} \PYG{l+m+mi}{1}
\PYG{k}{while} \PYG{n}{i} \PYG{o}{\PYGZlt{}} \PYG{n}{n}
\PYG{n}{j} \PYG{o}{=} \PYG{n}{i} \PYG{o}{+} \PYG{l+m+mi}{1}
\PYG{k}{if} \PYG{n+nb}{type}\PYG{p}{(}\PYG{n}{ordered\PYGZus{}connector}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)} \PYG{o}{==} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{junction}\PYG{l+s+s2}{\PYGZdq{}}
      \PYG{k}{while} \PYG{n+nb}{type}\PYG{p}{(}\PYG{n}{ordered\PYGZus{}connector}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]}\PYG{p}{)} \PYG{o}{==} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{junction}\PYG{l+s+s2}{\PYGZdq{}}
            \PYG{n}{connect}\PYG{p}{(}\PYG{n}{ordered\PYGZus{}connector}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ordered\PYGZus{}connector}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]}\PYG{p}{)}
            \PYG{n}{annotation}\PYG{p}{(}\PYG{n}{Line}\PYG{p}{(}\PYG{n}{points}\PYG{o}{=}\PYG{n}{create\PYGZus{}new\PYGZus{}path}\PYG{p}{(}\PYG{n}{ordered\PYGZus{}connector}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ordered\PYGZus{}connector}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
            \PYG{n}{j} \PYG{o}{=} \PYG{n}{j} \PYG{o}{+} \PYG{l+m+mi}{1}
      \PYG{n}{i} \PYG{o}{=} \PYG{n}{j}
\PYG{k}{else}
      \PYG{n}{connect}\PYG{p}{(}\PYG{n}{ordered\PYGZus{}connector}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ordered\PYGZus{}connector}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]}\PYG{p}{)}
      \PYG{n}{annotation}\PYG{p}{(}\PYG{n}{Line}\PYG{p}{(}\PYG{n}{points}\PYG{o}{=}\PYG{n}{create\PYGZus{}new\PYGZus{}path}\PYG{p}{(}\PYG{n}{ordered\PYGZus{}connector}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ordered\PYGZus{}connector}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
      \PYG{n}{i} \PYG{o}{=} \PYG{n}{j} \PYG{o}{+} \PYG{l+m+mi}{1}
\end{sphinxVerbatim}

The only valid connections are \sphinxcode{\sphinxupquote{junction}} with \sphinxcode{\sphinxupquote{junction}} and \sphinxcode{\sphinxupquote{outlet}} with \sphinxcode{\sphinxupquote{inlet}}: throw an exception otherwise.

\hyperref[\detokenize{requirements:linkage-connect-junction}]{Fig.\@ \ref{\detokenize{requirements:linkage-connect-junction}}} further illustrates the logic for connecting \sphinxcode{\sphinxupquote{junction}} ports.

\end{itemize}

\end{itemize}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{linkage_connect_junction}.pdf}
\caption{Logic of ports connection in case of \sphinxcode{\sphinxupquote{inlet}} and \sphinxcode{\sphinxupquote{outlet}} ports (top) and \sphinxcode{\sphinxupquote{junction}} ports (bottom)}\label{\detokenize{requirements:linkage-connect-junction}}\end{figure}

The implications of that logic are the following:
\begin{itemize}
\item {} 
Within the same fluid path, objects are connected in a given direction and orientation: to represent a fluid loop (graphically) at least two fluid paths must be defined, typically \sphinxcode{\sphinxupquote{supply}} and \sphinxcode{\sphinxupquote{return}}.

\item {} 
A same fluid path does not necessarily imply a uniform flow rate.

\item {} 
Among the multiple connectors which are part of the same junction, only one can have a paired \sphinxcode{\sphinxupquote{outlet}} connector (part of the same component) within the same fluid path and the corresponding component must be placed further downstream. There is always the modeling alternative which consists in representing a junction by introducing a new fluid path as in \hyperref[\detokenize{requirements:linkage-connect-multi}]{Fig.\@ \ref{\detokenize{requirements:linkage-connect-multi}}}.

\end{itemize}


\subsection{Signal Connectors}
\label{\detokenize{requirements:signal-connectors}}
Generating the \sphinxcode{\sphinxupquote{connect}} equations for signal variables relies on string matching with the names of the variables declared in a a so-called \sphinxtitleref{control bus} which has the type of an expandable connector type, see \sphinxstyleemphasis{\S{}9.1.3
Expandable Connectors} in \sphinxcite{bibliography:modelica2017}.

The following features of the expandable connector are leveraged:
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
All components in an expandable connector are seen as connector instances even if they are not declared as such. In comparison to a non expandable connector, that means that each variable (even of type \sphinxcode{\sphinxupquote{Real}}) can be connected i.e. be part of a \sphinxcode{\sphinxupquote{connect}} equation.

\begin{sphinxadmonition}{note}{Note:}\begin{itemize}
\item {} 
Connecting a non connector variable to a connector variable with \sphinxcode{\sphinxupquote{connect(non\_connector\_var, connector\_var)}} yields a warning but not an error. It is considered bad practice though and a standard equation should be used in place \sphinxcode{\sphinxupquote{non\_connector\_var = connector\_var}}.

\item {} 
Using a \sphinxcode{\sphinxupquote{connect}} equation allows to draw a connection line which makes the model structure explicit to the user. Furthermore it avoids mixing \sphinxcode{\sphinxupquote{connect}} equations and standard equations within the same equation set, which has been adopted as a best practice in the Modelica Buildings library.

\end{itemize}
\end{sphinxadmonition}

\item {} 
The causality (input or output) of each variable inside an expandable connector is not predefined but rather set by the \sphinxcode{\sphinxupquote{connect}} equation where the variable is first being used. For instance when a variable is first connected to an inside connector \sphinxcode{\sphinxupquote{Modelica.Blocks.Interfaces.RealOutput}} it gets the same causality i.e. output. The same variable can then be connected to another inside connector  \sphinxcode{\sphinxupquote{Modelica.Blocks.Interfaces.RealInput}}.

\item {} 
Possibly present but not connected variable is considered not declared: all variables need not be connected so the \sphinxtitleref{control bus} does not have to be reconfigured depending on the model structure.

\item {} 
The variables set of a class of type expandable connector is expanded whenever a new variable gets connected to any \sphinxstyleemphasis{instance} of the class. Though that feature is not needed by the \sphinxtitleref{Configuration widget} (we will have a predefined \sphinxtitleref{control bus} with declared variables corresponding to the control sequences implemented for each system), it is needed to allow the user further modifying the control sequence. Adding new control variables is simply done by connecting them to the \sphinxtitleref{control bus}.

\end{enumerate}

Those features are illustrated with a minimal example in the figures below where:
\begin{itemize}
\item {} 
a controlled system consisting in a sensor (idealized with a real expression) and an actuator (idealized with a simple block passing through the value of the input control signal) is connected with,

\item {} 
a controller system which divides the input variable (measurement) by itself and outputs a control variable equal to one.

\item {} 
The same model is first implemented with an expandable connector and then with a standard connector.

\end{itemize}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=0.500\linewidth]{{BusTestExp}.pdf}
\caption{Minimal example illustrating the connection scheme with an expandable connector \textendash{} Top level}\label{\detokenize{requirements:bustestexp}}\end{figure}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kr}{model} \PYG{n+nc}{BusTestExp}
\PYG{n}{BusTestControllerExp} \PYG{n}{controllerSystem}\PYG{p}{;}
\PYG{n}{BusTestControlledExp} \PYG{n}{controlledSystem}\PYG{p}{;}
\PYG{k+kr}{equation}
      \PYG{k+kr}{connect}\PYG{p}{(}\PYG{n}{controllerSystem}\PYG{o}{.}\PYG{n}{ahuBus}\PYG{p}{,} \PYG{n}{controlledSystem}\PYG{o}{.}\PYG{n}{ahuBus}\PYG{p}{);}
\PYG{k+kr}{end} \PYG{n+nc}{BusTestExp}\PYG{p}{;}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=0.500\linewidth]{{BusTestControlledExp}.pdf}
\caption{Minimal example illustrating the connection scheme with an expandable connector \textendash{} Controlled component sublevel}\label{\detokenize{requirements:bustestcontrolledexp}}\end{figure}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kr}{model} \PYG{n+nc}{BusTestControlledExp}
\PYG{n}{Modelica}\PYG{o}{.}\PYG{n}{Blocks}\PYG{o}{.}\PYG{n}{Sources}\PYG{o}{.}\PYG{n}{RealExpression} \PYG{n}{sensor}\PYG{p}{(}\PYG{n}{y}\PYG{o}{=}\PYG{l+m+mi}{2} \PYG{o}{+} \PYG{n+nb}{sin}\PYG{p}{(}\PYG{n+nb}{time}\PYG{o}{*}\PYG{l+m+mf}{3.14}\PYG{p}{));}
\PYG{n}{Buildings}\PYG{o}{.}\PYG{n}{Experimental}\PYG{o}{.}\PYG{n}{Templates}\PYG{o}{.}\PYG{n}{BaseClasses}\PYG{o}{.}\PYG{n}{AhuBus} \PYG{n}{ahuBus}\PYG{p}{;}
\PYG{n}{Modelica}\PYG{o}{.}\PYG{n}{Blocks}\PYG{o}{.}\PYG{n}{Routing}\PYG{o}{.}\PYG{n}{RealPassThrough} \PYG{n}{actuator}\PYG{p}{;}
\PYG{k+kr}{equation}
      \PYG{k+kr}{connect}\PYG{p}{(}\PYG{n}{sensor}\PYG{o}{.}\PYG{n}{y}\PYG{p}{,} \PYG{n}{ahuBus}\PYG{o}{.}\PYG{n}{yMea}\PYG{p}{);}
      \PYG{k+kr}{connect}\PYG{p}{(}\PYG{n}{ahuBus}\PYG{o}{.}\PYG{n}{yAct}\PYG{p}{,} \PYG{n}{actuator}\PYG{o}{.}\PYG{n}{u}\PYG{p}{);}
\PYG{k+kr}{end} \PYG{n+nc}{BusTestControlledExp}\PYG{p}{;}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kr}{expandable} \PYG{k+kr}{connector} \PYG{n+nc}{AhuBus}
\PYG{k+kr}{extends} \PYG{n}{Modelica}\PYG{o}{.}\PYG{n}{Icons}\PYG{o}{.}\PYG{n}{SignalBus}\PYG{p}{;}
\PYG{k+kr}{end} \PYG{n+nc}{AhuBus}\PYG{p}{;}
\end{sphinxVerbatim}

\begin{sphinxadmonition}{note}{Note:}
The definition of \sphinxcode{\sphinxupquote{AhuBus}} in the code snippet here above does not include any variable declaration. However the variables \sphinxcode{\sphinxupquote{ahuBus.yAct}} and \sphinxcode{\sphinxupquote{ahuBus.yMea}} are used in \sphinxcode{\sphinxupquote{connect}} equations. That is only possible with an expandable connector.

For the \sphinxtitleref{Configuration widget} we will have predeclared variables with names allowing a one-to-one correspondence between:
\begin{itemize}
\item {} 
the control sequence input variables and the outputs of the equipment model e.g. measured quantities and actuators returned positions,

\item {} 
the control sequence output variables and the inputs of the equipment model e.g. actuators commanded positions.

\end{itemize}

The control bus variables are used as “gateways” to stream values between the controlled and controller systems.

For clarity it might be useful to group control input variables in one sub-bus and control output variables in another sub-bus.
The \sphinxhref{https://www.claytex.com/blog/libraries/rationalisation-bus-sub-bus-signals-engines-library}{experience feedback on bus usage in Modelica} shows that restricting the number of sub-buses and the use of bus variables to sensed and actuated signals only is a preferred option: the number of signals passing through busses has an impact on the number of equations and the simulation time.
\end{sphinxadmonition}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=0.500\linewidth]{{l}.pdf}
\caption{Minimal example illustrating the connection scheme with an expandable connector \textendash{} Controller component sublevel}\label{\detokenize{requirements:bustestcontrollerexp}}\end{figure}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kr}{model} \PYG{n+nc}{BusTestControlledExp}
      \PYG{n}{Modelica}\PYG{o}{.}\PYG{n}{Blocks}\PYG{o}{.}\PYG{n}{Sources}\PYG{o}{.}\PYG{n}{RealExpression} \PYG{n}{sensor}\PYG{p}{(}\PYG{n}{y}\PYG{o}{=}\PYG{l+m+mi}{2} \PYG{o}{+} \PYG{n+nb}{sin}\PYG{p}{(}\PYG{n+nb}{time}\PYG{o}{*}\PYG{l+m+mf}{3.14}\PYG{p}{));}
      \PYG{n}{Buildings}\PYG{o}{.}\PYG{n}{Experimental}\PYG{o}{.}\PYG{n}{Templates}\PYG{o}{.}\PYG{n}{BaseClasses}\PYG{o}{.}\PYG{n}{AhuBus} \PYG{n}{ahuBus}\PYG{p}{;}
      \PYG{n}{Modelica}\PYG{o}{.}\PYG{n}{Blocks}\PYG{o}{.}\PYG{n}{Routing}\PYG{o}{.}\PYG{n}{RealPassThrough} \PYG{n}{actuator}\PYG{p}{;}
\PYG{k+kr}{equation}
      \PYG{k+kr}{connect}\PYG{p}{(}\PYG{n}{ahuBus}\PYG{o}{.}\PYG{n}{yAct}\PYG{p}{,} \PYG{n}{actuator}\PYG{o}{.}\PYG{n}{u}\PYG{p}{);}
      \PYG{k+kr}{connect}\PYG{p}{(}\PYG{n}{sensor}\PYG{o}{.}\PYG{n}{y}\PYG{p}{,} \PYG{n}{ahuBus}\PYG{o}{.}\PYG{n}{yMea}\PYG{p}{)}
\PYG{k+kr}{end} \PYG{n+nc}{BusTestControlledExp}\PYG{p}{;}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=0.500\linewidth]{{BusTestNonExp}.pdf}
\caption{Minimal example illustrating the connection scheme with a standard connector \textendash{} Top level}\label{\detokenize{requirements:bustestnonexp}}\end{figure}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kr}{model} \PYG{n+nc}{BusTestNonExp}
\PYG{n}{BusTestControllerNonExp} \PYG{n}{controllerSystem}\PYG{p}{;}
\PYG{n}{BusTestControlledNonExp} \PYG{n}{controlledSystem}\PYG{p}{;}
\PYG{k+kr}{equation}
      \PYG{k+kr}{connect}\PYG{p}{(}\PYG{n}{controllerSystem}\PYG{o}{.}\PYG{n}{nonExpandableBus}\PYG{p}{,} \PYG{n}{controlledSystem}\PYG{o}{.}\PYG{n}{nonExpandableBus}\PYG{p}{);}
\PYG{k+kr}{end} \PYG{n+nc}{BusTestNonExp}\PYG{p}{;}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=0.500\linewidth]{{BusTestControlledNonExp}.pdf}
\caption{Minimal example illustrating the connection scheme with a standard connector \textendash{} Controlled component sublevel}\label{\detokenize{requirements:bustestcontrollednonexp}}\end{figure}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kr}{model} \PYG{n+nc}{BusTestControlledNonExp}
\PYG{n}{Modelica}\PYG{o}{.}\PYG{n}{Blocks}\PYG{o}{.}\PYG{n}{Sources}\PYG{o}{.}\PYG{n}{RealExpression} \PYG{n}{sensor}\PYG{p}{(}\PYG{n}{y}\PYG{o}{=}\PYG{l+m+mi}{2} \PYG{o}{+} \PYG{n+nb}{sin}\PYG{p}{(}\PYG{n+nb}{time}\PYG{o}{*}\PYG{l+m+mf}{3.14}\PYG{p}{));}
\PYG{n}{Modelica}\PYG{o}{.}\PYG{n}{Blocks}\PYG{o}{.}\PYG{n}{Routing}\PYG{o}{.}\PYG{n}{RealPassThrough} \PYG{n}{actuator}\PYG{p}{;}
\PYG{n}{BaseClasses}\PYG{o}{.}\PYG{n}{NonExpandableBus} \PYG{n}{nonExpandableBus}\PYG{p}{;}
\PYG{k+kr}{equation}
      \PYG{n}{nonExpandableBus}\PYG{o}{.}\PYG{n}{yMea} \PYG{o}{=} \PYG{n}{sensor}\PYG{o}{.}\PYG{n}{y}\PYG{p}{;}
      \PYG{n}{actuator}\PYG{o}{.}\PYG{n}{u} \PYG{o}{=} \PYG{n}{nonExpandableBus}\PYG{o}{.}\PYG{n}{yAct}\PYG{p}{;}
\PYG{k+kr}{end} \PYG{n+nc}{BusTestControlledNonExp}\PYG{p}{;}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kr}{connector} \PYG{n+nc}{NonExpandableBus}
\PYG{c+c1}{// The following declarations are required.}
\PYG{c+c1}{// The variables are not considered as connectors: they cannot be part of connect equations.}
\PYG{n+nb}{Real} \PYG{n}{yMea}\PYG{p}{;}
\PYG{n+nb}{Real} \PYG{n}{yAct}\PYG{p}{;}
\PYG{k+kr}{end} \PYG{n+nc}{NonExpandableBus}\PYG{p}{;}
\end{sphinxVerbatim}

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics[width=0.500\linewidth]{{BusTestControllerNonExp}.pdf}
\caption{Minimal example illustrating the connection scheme with a standard connector \textendash{} Controller component sublevel}\label{\detokenize{requirements:bustestcontrollernonexp}}\end{figure}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kr}{model} \PYG{n+nc}{BusTestControllerNonExp}
\PYG{n}{Controls}\PYG{o}{.}\PYG{n}{OBC}\PYG{o}{.}\PYG{n}{CDL}\PYG{o}{.}\PYG{n}{Continuous}\PYG{o}{.}\PYG{n}{Division} \PYG{n}{controller}\PYG{p}{;}
\PYG{n}{Modelica}\PYG{o}{.}\PYG{n}{Blocks}\PYG{o}{.}\PYG{n}{Routing}\PYG{o}{.}\PYG{n}{RealPassThrough} \PYG{n}{realPassThrough}\PYG{p}{;}
\PYG{n}{BaseClasses}\PYG{o}{.}\PYG{n}{NonExpandableBus} \PYG{n}{nonExpandableBus}\PYG{p}{;}
\PYG{k+kr}{equation}
      \PYG{k+kr}{connect}\PYG{p}{(}\PYG{n}{realPassThrough}\PYG{o}{.}\PYG{n}{y}\PYG{p}{,} \PYG{n}{controller}\PYG{o}{.}\PYG{n}{u1}\PYG{p}{);}
      \PYG{n}{controller}\PYG{o}{.}\PYG{n}{u2} \PYG{o}{=} \PYG{n}{nonExpandableBus}\PYG{o}{.}\PYG{n}{yMea}\PYG{p}{;}
      \PYG{n}{nonExpandableBus}\PYG{o}{.}\PYG{n}{yAct} \PYG{o}{=} \PYG{n}{controller}\PYG{o}{.}\PYG{n}{y}\PYG{p}{;}
      \PYG{n}{realPassThrough}\PYG{o}{.}\PYG{n}{u} \PYG{o}{=} \PYG{n}{nonExpandableBus}\PYG{o}{.}\PYG{n}{yMea}\PYG{p}{;}
\PYG{k+kr}{end} \PYG{n+nc}{BusTestControllerNonExp}\PYG{p}{;}
\end{sphinxVerbatim}

The algorithm is as follows:
\begin{itemize}
\item {} 
\end{itemize}


\chapter{Issues}
\label{\detokenize{requirements:issues}}
We have a linked modelica model residing on disk. When loading that model, LinkageJS must be able to:
\begin{itemize}
\item {} 
identify which object and \sphinxcode{\sphinxupquote{connect}} statement can be modified with the template script: declaration/statement annotation \sphinxcode{\sphinxupquote{\_\_Linkage\_modify=true}}

\item {} 
generate the JSON configuration file:
\begin{itemize}
\item {} 
automatically from the model structure? Non working examples:

\item {} 
Supply fan/Draw through: if the user has modified the \sphinxcode{\sphinxupquote{Placement}} we have no one-to-one correspondance with JSON file. Also relying on the \sphinxcode{\sphinxupquote{connect}} statements involving the object seems to complex.

\end{itemize}

\end{itemize}


\chapter{Questions}
\label{\detokenize{requirements:questions}}\begin{itemize}
\item {} 
Validation upon submit (export/generate) VS real-time

\item {} 
Routine to add sensors for control sequences

\item {} 
Routine to add fluid ports: part of data model?

\end{itemize}

Choice of units: SI / IP

Launch simulation integrated
\begin{itemize}
\item {} 
At least compilation required to validate the model?

\item {} 
For control sequence configuration the model may not need to be fully specified.

\end{itemize}

Visualize results: variable browser (with Brick/Haystack option similar as \sphinxcode{\sphinxupquote{re}} option)

No icon layer: just diagram layer showing graphical objects, component icons, connectors and connection lines

Automatic medium propagation between connected components
\begin{itemize}
\item {} 
Expected as a future enhancement of Modelica standard: should we anticipate or wait and see?

\end{itemize}

\begin{sphinxadmonition}{note}{Note:}
Brick and tagging

Set up parameters values like OS measures enable cf. electrical loads…

From Taylor Eng.

For standard systems, it might be possible to simply include in their specifications a table of ASHRAE Guideline 36 sequences with check boxes for the paragraph numbers that are applicable to their project.

From \sphinxurl{https://build.openmodelica.org/Documentation/Modelica.Fluid.UsersGuide.ComponentDefinition.FluidConnectors.html}

With the current library design, it is necessary to explicitly select the medium model for each component in a circuit. This model is then propagated to the ports, and a Modelica translator will check that the quantity and unit attributes of connected interfaces are identical. Therefore, an error occurs, if connected FluidPorts do not have a medium with the same medium name. In the future, automatic propagation of fluid models through the ports will be introduced, but this still not possible with Modelica 3.0.
\end{sphinxadmonition}


\chapter{Software Architecture}
\label{\detokenize{softwareArchitecture:software-architecture}}\label{\detokenize{softwareArchitecture:sec-soft-arch}}\label{\detokenize{softwareArchitecture::doc}}
This section describes the software architecture
of the LinkageJS tool and the functional verification tool.
In the text below, we mean by \sphinxstyleemphasis{plant} the HVAC and building system,
and by \sphinxstyleemphasis{control} the controls other than product integrated controllers
(PIC).
Thus, the HVAC or building system model may, and likely will,
contain product integrated controllers, which will be out
of scope for CDL apart from reading measured values from PICs and
sending setpoints to PICs.


\chapter{Glossary}
\label{\detokenize{glossary:glossary}}\label{\detokenize{glossary:sec-glossary}}\label{\detokenize{glossary::doc}}
This section provides definitions for abbreviations and terms introduced in
the Open Building Controls project.
\begin{description}
\item[{Analog Value\index{Analog Value@\spxentry{Analog Value}|spxpagem}\phantomsection\label{\detokenize{glossary:term-analog-value}}}] \leavevmode
In CDL, we say a value is analog if it represents a continuous
number. The value may be presented by an analog signal such as
voltage, or by a digital signal.

\item[{Binary Value\index{Binary Value@\spxentry{Binary Value}|spxpagem}\phantomsection\label{\detokenize{glossary:term-binary-value}}}] \leavevmode
In CDL, we say a value is binary if it can take on the values
0 and 1. The value may however be presented by an analog signal
that can take on two values (within some tolerance) in order
to communicate the binary value.

\item[{Building Model\index{Building Model@\spxentry{Building Model}|spxpagem}\phantomsection\label{\detokenize{glossary:term-building-model}}}] \leavevmode
Digital model of the physical behavior of a given building over time,
which accounts for any elements of the building envelope and includes a
representation of internal gains and occupancy. Building model has connectors
to be coupled with an environment model and any HVAC and non-HVAC system models
pertaining to the building.

\end{description}


\chapter{Acknowledgments}
\label{\detokenize{acknowledgments:acknowledgments}}\label{\detokenize{acknowledgments::doc}}
This research was supported by
\begin{itemize}
\item {} 
the Assistant Secretary for
Energy Efficiency and Renewable Energy, Office of Building Technologies
of the U.S. Department of Energy, under Contract No. DE-AC02-05CH11231, and

\item {} 
the California Energy Commission’s Electric Program Investment Charge (EPIC) Program.

\end{itemize}


\chapter{References}
\label{\detokenize{bibliography:references}}\label{\detokenize{bibliography:id1}}\label{\detokenize{bibliography::doc}}


\begin{sphinxthebibliography}{Mod17}
\bibitem[Bri]{bibliography:brick}
\sphinxstyleemphasis{Brick \textendash{} A Uniform Metadata Schema for Buildings}. URL: \sphinxurl{https://brickschema.org/\#home}.
\bibitem[Mod17]{bibliography:modelica2017}
\sphinxstyleemphasis{Modelica \textendash{} A Unified Object-Oriented Language for Physical Systems Modeling, Language Specification, Version 3.4}. Modelica Association, April 2017. URL: \sphinxurl{https://www.modelica.org/documents/ModelicaSpec34.pdf}.
\end{sphinxthebibliography}



\renewcommand{\indexname}{Index}
\printindex
\end{document}